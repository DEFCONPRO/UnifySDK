<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Unify Specification: AoX Application</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Unify Specification
   &#160;<span id="projectnumber">ver1_0_RC11_20211006-12-g5cdaf55</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">AoX Application </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This chapter contains cluster definitions used to support the AoX application. These cluster definitions are unique to the Unify Controller Language. This is an addition to the clusters already defined in the ZCL.</p>
<h1><a class="anchor" id="autotoc_md145"></a>
Terminology</h1>
<p>We define here several entities as part of an AoX system:</p>
<ul>
<li><p class="startli"><b>Assets Tags</b></p>
<p class="startli">Assets tags are radio devices sending unencrypted radio beacons that allow to triangulate assets.</p>
</li>
<li><p class="startli"><b>AoX Protocol Controller / Locator</b></p>
<p class="startli">The AoXPC is a component that processes incoming radio beacons, converts them into IQ Reports or Angle reports, which will allow another component to compute the position of the device. A locator is a part of the AoX Protocol Controller, it is basically an NCP with a configuration that will help to determine the relative position of an asset tag.</p>
</li>
<li><p class="startli"><b>AoX Positioning Service</b></p>
<p class="startli">This is essentially a helper component (like the SmartStart list manager) that reads the data reported from the locators and will compute and publish the absolute position of each tag.</p>
</li>
</ul>
<p>The system can be seen as follows:</p>
<div class="plantumlgraph">
<img src="inline_umlgraph_25.png" />
</div>
<h1><a class="anchor" id="autotoc_md146"></a>
AoX Clusters</h1>
<p>This section defines how to represent Angle-of-X (e.g, Angle of Arrival) IQ report, Angle, and Position data in the Unify SDK.</p>
<p>The AoX system relies on several new clusters:</p>
<ul>
<li>AoXLocator, used to manage locator devices within the AoXPC.</li>
<li>AoXPositionEstimation, used to report Assets estimated position.</li>
</ul>
<h2><a class="anchor" id="autotoc_md147"></a>
Locators and the AoXLocator cluster</h2>
<p>The AoX Protocol Controller allows to read the configuration of its Locator using the AoXLocator Cluster. For example, an AoX Protocol Controller could advertise it like this:</p>
<div class="fragment"><div class="line">ucl/by-unid/&lt;aoxpc_unid&gt;/ep0/AoXLocator/Attributes/PositionAndOrientationValid/Desired {&quot;value&quot;: true}</div>
<div class="line">ucl/by-unid/&lt;aoxpc_unid&gt;/ep0/AoXLocator/Attributes/PositionAndOrientationValid/Reported {&quot;value&quot;: true}</div>
<div class="line">ucl/by-unid/&lt;aoxpc_unid&gt;/ep0/AoXLocator/Attributes/PositionAndOrientation/Desired {</div>
<div class="line">  &quot;value&quot;: {</div>
<div class="line">    &quot;CoordinateX&quot;: 3.75,</div>
<div class="line">    &quot;CoordinateY&quot;: 0,</div>
<div class="line">    &quot;CoordinateZ&quot;: 1.25,</div>
<div class="line">    &quot;OrientationX&quot;: 50,</div>
<div class="line">    &quot;OrientationY&quot;: 0,</div>
<div class="line">    &quot;OrientationZ&quot;: 0</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line">ucl/by-unid/&lt;aoxpc_unid&gt;/ep0/AoXLocator/Attributes/PositionAndOrientation/Reported {</div>
<div class="line">  &quot;value&quot;: {</div>
<div class="line">    &quot;CoordinateX&quot;: 3.75,</div>
<div class="line">    &quot;CoordinateY&quot;: 0,</div>
<div class="line">    &quot;CoordinateZ&quot;: 1.25,</div>
<div class="line">    &quot;OrientationX&quot;: 50,</div>
<div class="line">    &quot;OrientationY&quot;: 0,</div>
<div class="line">    &quot;OrientationZ&quot;: 0</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><p>The <code>PositionAndOrientation</code> represents the the location of the NCP radio for the AoX locator. CoordinateX, CoordinateY, CoordinateZ are cartesian coordinates, in meters. OrientationX, OrientationY and OrientationZ are the axis rotation (Euler angles) in degrees. More details are provided in <a href="https://docs.silabs.com/rtl-lib/latest/group-sl-rtl-loc#structsl-rtl-loc-locator-item">Silicon Labs RTL Locator item</a></p>
<p>The additional <code>PositionAndOrientationValid</code> boolean attribute indicates if the locator <code>PositionAndOrientation</code> attributes has been set and the reported values reported are correct.</p>
<p>A subscription to <code>ucl/by-unid/&lt;aoxpc_unid&gt;/ep0/AoXLocator/Attributes/#</code> will allow to read the entire configuration and possibly write back the configuration that is writable.</p>
<p>The AoXLocator Cluster can be configured using the AoXLocator cluster <b>WriteAttributes</b> command.</p>
<div class="fragment"><div class="line">ucl/by-unid/&lt;aoxpc_unid&gt;/ep0/AoXLocator/SupportedCommands {&quot;value&quot;: [&quot;AngleCorrection&quot;, &quot;WriteAttributes&quot;]}</div>
<div class="line">ucl/by-unid/&lt;aoxpc_unid&gt;/ep0/AoXLocator/SupportedGeneratedCommands {&quot;value&quot;: [&quot;IQReport&quot;]}</div>
</div><!-- fragment --><p>An AoX Protocol Controller MUST generate an <code>IQReport</code> or an <code>AngleReport</code> Command for every radio beacon that has been received by a locator.</p>
<div class="fragment"><div class="line">ucl/by-unid/&lt;aoxpc_unid&gt;/ep0/AoXLocator/GeneratedCommands/IQReport {</div>
<div class="line">    &quot;TagUnid&quot; : &quot;ble-pd-842E1431C9F0&quot;,</div>
<div class="line">    &quot;Channel&quot;: 13,</div>
<div class="line">    &quot;Rssi&quot;: -50,</div>
<div class="line">    &quot;Sequence&quot;: 42767,</div>
<div class="line">    &quot;Samples&quot;: [23, 105, 106, -10, 2, -108]</div>
<div class="line">}</div>
</div><!-- fragment --><p>Or</p>
<div class="fragment"><div class="line">ucl/by-unid/&lt;aoxpc_unid&gt;/ep0/AoXLocator/GeneratedCommands/AngleReport {</div>
<div class="line">{</div>
<div class="line">  &quot;Deviation&quot;: {</div>
<div class="line">    &quot;Azimuth&quot;: 0,</div>
<div class="line">    &quot;Distance&quot;: 0,</div>
<div class="line">    &quot;Elevation&quot;: 0</div>
<div class="line">  },</div>
<div class="line">  &quot;Direction&quot;: {</div>
<div class="line">    &quot;Azimuth&quot;: -6.4180755615234375,</div>
<div class="line">    &quot;Distance&quot;: 1.5519763231277466,</div>
<div class="line">    &quot;Elevation&quot;: 51.71907043457031</div>
<div class="line">  },</div>
<div class="line">  &quot;Sequence&quot;: 42767,</div>
<div class="line">  &quot;TagUnid&quot;: &quot;ble-pd-842E1431C9F0&quot;</div>
<div class="line">}</div>
</div><!-- fragment --><p>In the <code>AngleReport</code> commands, <code>Direction</code> represents the measured angle data while <code>Deviation</code> indicates the standard deviation of the that measurement. Both <code>Direction</code> and <code>Deviation</code> are spherical coordinates. In sphrical coordinates objects, the <code>Azimuth</code>and <code>Elevation</code> are in degrees and the <code>Distance</code> is in meter.</p>
<p>More details about how to interpret the values in the IQReports or AngleReports are given in <a href="https://docs.silabs.com/rtl-lib/latest/">Silicon Labs RTL Library</a> and <a href="https://www.silabs.com/documents/public/user-guides/ug103-18-bluetooth-direction-finding-fundamentals.pdf">Silicon Labs User Guide 103.18</a></p>
<p>Each locator will generate 'IQReport' or 'AngleReport'. Locators supporting both modes will advertise which mode is configured using the <code>ReportingMode</code> attribute configuration. If the "ReportingMode" attribute is not writable, it will not be advertised and instead IoT Services will be able to know what commands are generated reading the value published at the SupportedGeneratedCommands topic:</p>
<div class="fragment"><div class="line">ucl/by-unid/&lt;aoxpc_unid&gt;/ep0/AoXLocator/SupportedGeneratedCommands {&quot;value&quot;: [&quot;AngleReport&quot;]}</div>
</div><!-- fragment --><p>For example, the following diagram shows an example of configuring which commands are generated by a locator.</p>
<div class="plantumlgraph">
<img src="inline_umlgraph_26.png" />
</div>
<h3><a class="anchor" id="autotoc_md148"></a>
AngleCorrection Command</h3>
<p>For calibration and accuracy purposes, AoX locators generating <code>AngleReport</code> commands SHOULD support receiving the <code>AngleCorrection</code> command. The <code>AngleCorrection</code> command will indicate what values are expected for a given asset tag to an AoX locator.</p>
<p>Details on applying angle correction are given in <a href="https://docs.silabs.com/rtl-lib/latest/group-sl-rtl-loc#ga788dcffb47a4bbb26b110bb9e817b0e5">Silicon Labs RTL Library: Get expected direction</a></p>
<h2><a class="anchor" id="autotoc_md149"></a>
AoXPositionEstimation cluster</h2>
<p>A Positioning Service helper MQTT client can be used to listen to MQTT publications coming from the AoXLocator cluster to determine the position of each tag in the system.</p>
<p>The Positioning Service does not have a UNID itself. It connects to the MQTT broker, and performs the following actions:</p>
<ol type="1">
<li>a. Reads the configuration for each AoXPC / Locator, using a subscription to <code>ucl/by-unid/+/+/AoXLocator/Attributes/+/Reported</code></li>
</ol>
<ol type="1">
<li>b. Optionally adjusts the configuration issuing WriteAttributes Command <code>ucl/by-unid/+/+/AoXLocator/Commands/WriteAttributes</code></li>
<li>Listen to incoming IQReport or AngleReports by subscribing to: <code>ucl/by-unid/+/+/AoXLocator/GeneratedCommands/+</code></li>
</ol>
<p>Whenever position data for a tag is available, the Positioning Service MUST publish the calculated Position attribute in the AoXPositionEstimation Cluster.</p>
<p><b>MQTT topics:</b></p>
<ul>
<li><code>ucl/by-unid/&lt;TAG_UNID&gt;/ep0/AoXPositionEstimation/Attributes/Position/Desired</code></li>
<li><code>ucl/by-unid/&lt;TAG_UNID&gt;/ep0/AoXPositionEstimation/Attributes/Position/Reported</code></li>
</ul>
<p><b>Payload:</b></p>
<div class="fragment"><div class="line">{</div>
<div class="line">  &quot;value&quot;: {</div>
<div class="line">    &quot;ApplicationId&quot;: &quot;positioning_4154&quot;,</div>
<div class="line">    &quot;DeviationX&quot;: 3.1297969818115234,</div>
<div class="line">    &quot;DeviationY&quot;: 0.6999226212501526,</div>
<div class="line">    &quot;DeviationZ&quot;: 3.8446271419525146,</div>
<div class="line">    &quot;Sequence&quot;: 47021,</div>
<div class="line">    &quot;X&quot;: 0.8519021272659302,</div>
<div class="line">    &quot;Y&quot;: 0.000349800189724192,</div>
<div class="line">    &quot;Z&quot;: 0.8335742950439453</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><p>In the <code>Position</code> attribute, Coordinate components (<code>X</code>, <code>Y</code>, etc.) unit is Meter.</p>
<p>The first time that a tag's position is determined, or a new tag is detected, the Positioning Service application MUST publish a node state topic for that tag.</p>
<div class="fragment"><div class="line">ucl/by-unid/&lt;TAG_UNID&gt;/State</div>
<div class="line">{</div>
<div class="line">    &quot;NetworkStatus&quot;: &quot;Online functional&quot;,</div>
<div class="line">    &quot;Security&quot;: &quot;None&quot;,</div>
<div class="line">    &quot;MaximumCommandDelay&quot;: &quot;unknown&quot;}</div>
<div class="line">}</div>
</div><!-- fragment --><p>When a Positioning Service application shuts down, it MUST unretain all the AoXPositionEstimation and State data that it published for tags. </p>
<h2><a class="anchor" id="autotoc_md150"></a>
Positioning Service</h2>
<p>The Positioning Service is a helper component that can determine spatial coordinates, or position, for each tag UNID and publises the last reported position.</p>
<h2><a class="anchor" id="autotoc_md151"></a>
Asset Tag UNIDs</h2>
<p>Asset Tag UNIDs MUST indicate the BLE address type in addition to the BLE address. The generic format is <code>ble-&lt;ADDRESS_TYPE&gt;-&lt;BLE_ADDRESS&gt;</code>. Refer to <a class="el" href="md_doc__chapter01-architecture-overview.html">Architecture overview</a> for details about UNID composition. Static random addresses can be abbreviated <b>sr</b> and public device addresses <b>pd</b>.</p>
<p>An example of a public device address UNID is <code>ble-pd-842E1431C9F0</code>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>

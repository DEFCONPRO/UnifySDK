<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Unify Specification: Binding</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Unify Specification
   &#160;<span id="projectnumber">ver1_0_RC11_20211006-19-g32c28c7</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Binding </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This chapter describes how to use the binding functionality in Unify.</p>
<p>The unify binding feature can be used by an IoT service / rules engine to impose direct rules between nodes on the PAN or even for nodes between PAN and wireless protocols. The benefit of the direct rules are a binding between two nodes in the same network will impose less network latency compared to a star topology where all events needs to be passed though an IoT service. Another benefit is that in the event of the a protocol controller going offline the binding rules setup in the network will still work.</p>
<p>The Unify Binding framework also features a system to identify which nodes can be bound. Care must be taken when IoT services setup bindings, because the Protocol Controllers will not sanitise whether a binding is safe from a security perspective.</p>
<p>An IoT service MUST verify what a binding is acceptable from a perspective before setting up the binding. </p>
<h1><a class="anchor" id="autotoc_md145"></a>
Establishing a binding</h1>
<p>The main use case of a binding is to have a PAN node cluster client issue commands directly to another PAN node cluster server.</p>
<p>An example is shown below.</p>
<div class="plantumlgraph">
<img src="inline_umlgraph_27.png" />
</div>
<h1><a class="anchor" id="autotoc_md146"></a>
Binding object</h1>
<p>A binding consists of the following elements/fields</p>
<ul>
<li><p class="startli"><b>SourceUnid</b>:</p>
<p class="startli">The UNID of the client node that will issue commands to the server.</p>
<p class="startli">This information will be found in the topic used to issue the command or read the attributes</p>
</li>
<li><p class="startli"><b>SourceEp</b>:</p>
<p class="startli">The Endpoint ID of the client node that will issue commands to the server</p>
<p class="startli">This information will be found in the topic used to issue the command or read the attributes</p>
</li>
<li><p class="startli"><b>ClusterName</b>:</p>
<p class="startli">The name of the ClusterID of the client node that will issue commands to the server</p>
</li>
<li><p class="startli"><b>DestinationUnid</b>:</p>
<p class="startli">The UNID of the server node that will receive commands from the client</p>
</li>
<li><p class="startli"><b>DestinationEp</b>:</p>
<p class="startli">The Endpoint ID of the server node that will receive commands from the client</p>
</li>
</ul>
<p>There is no real control over what triggers which commands from the client to the server. For example, an OccupancySensor server that is also an OnOff cluster client may decide to send On commands to bound device when OccupancySensing is True and Off when False, or vice-versa.</p>
<h2><a class="anchor" id="autotoc_md147"></a>
MQTT Topics and Parameters</h2>
<table class="doxtable">
<caption>Binding MQTT Topics</caption>
<tr>
<th>MQTT Topic </th><th>Description  </th></tr>
<tr>
<td>ucl/by-unid/+/+/Binding/Commands/ </td><td>Command topic space. IoT services can publish under this topic. See the XML file for command definitions.   </td></tr>
<tr>
<td>ucl/by-unid/+/+/Binding/Attributes/&lt;AttributeName&gt;/Reported </td><td>Used to publish the standard and additionnal attributes of the cluster. See the XML file for standard attributes definitions.  </td></tr>
<tr>
<td>ucl/by-unid/+/+/Binding/Attributes/&lt;AttributeName&gt;/Desired </td><td>Used to publish the standard and additionnal attributes of the cluster. See the XML file for standard attributes definitions.  </td></tr>
<tr>
<td>ucl/by-unid/+/+/Binding/SupportedCommands </td><td>Used to publish the supported commands.  </td></tr>
<tr>
<td>ucl/by-unid/+/+/Binding/SupportedGeneratedCommands </td><td>Used to publish the generated commands.  </td></tr>
<tr>
<td>ucl/by-unid/+/+/Binding/GeneratedCommands/&lt;CommandName&gt; </td><td>Topic used to publish generated commands.  </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md148"></a>
Additional attributes</h2>
<p>This cluster makes use of several additional attributes. These attributes are not present in the XML file. </p>
<h3><a class="anchor" id="autotoc_md149"></a>
Binding Table</h3>
<p>A binding table will be kept by each PAN node, keeping track of the established bindings.</p>
<p>The value of the binding table is an array of binding objects. Each binding object consists in a Cluster ID, Destination UNID and Destination Endpoint.</p>
<p>For example:</p>
<div class="fragment"><div class="line">ucl/by-unid/&lt;UNID&gt;/ep&lt;EndpointId&gt;/Binding/Attributes/BindingTable/Reported</div>
<div class="line">{ &quot;value&quot;: [</div>
<div class="line">    {&quot;ClusterName&quot; : &quot;OnOff&quot;, &quot;DestinationUnid&quot;: &quot;node_2&quot;, &quot;DestinationEp&quot;: 1},</div>
<div class="line">    {&quot;ClusterName&quot; : &quot;OnOff&quot;, &quot;DestinationUnid&quot;: &quot;node_2&quot;, &quot;DestinationEp&quot;: 2},</div>
<div class="line">    {&quot;ClusterName&quot; : &quot;Level&quot;, &quot;DestinationUnid&quot;: &quot;node_2&quot;, &quot;DestinationEp&quot;: 2}]</div>
<div class="line">}</div>
</div><!-- fragment --><p>The JSON schema for the BindingTable MUST be as follows:</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  &quot;$schema&quot;: &quot;http://json-schema.org/draft-07/schema#&quot;,</div>
<div class="line">  &quot;title&quot;: &quot;Binding Table&quot;,</div>
<div class="line">  &quot;description&quot;: &quot;Binding Table&quot;,</div>
<div class="line">  &quot;definitions&quot;: {</div>
<div class="line">    &quot;Binding Table Entry&quot;: {</div>
<div class="line">      &quot;type&quot;: &quot;object&quot;,</div>
<div class="line">      &quot;properties&quot;: {</div>
<div class="line">        &quot;ClusterName&quot;: {</div>
<div class="line">          &quot;type&quot;: &quot;string&quot;,</div>
<div class="line">          &quot;minLength&quot;: 1</div>
<div class="line">        },</div>
<div class="line">        &quot;DestinationUnid&quot;: {</div>
<div class="line">          &quot;type&quot;: &quot;string&quot;,</div>
<div class="line">          &quot;minLength&quot;: 1</div>
<div class="line">        },</div>
<div class="line">        &quot;DestinationEp&quot;: {</div>
<div class="line">          &quot;type&quot;: &quot;integer&quot;,</div>
<div class="line">          &quot;minimum&quot;: 0,</div>
<div class="line">          &quot;maximum&quot;: 254</div>
<div class="line">        }</div>
<div class="line">      },</div>
<div class="line">      &quot;required&quot;: [</div>
<div class="line">        &quot;ClusterName&quot;,</div>
<div class="line">        &quot;DestinationUnid&quot;,</div>
<div class="line">        &quot;DestinationEp&quot;</div>
<div class="line">      ]</div>
<div class="line">    }</div>
<div class="line">  },</div>
<div class="line">  &quot;type&quot;: &quot;object&quot;,</div>
<div class="line">  &quot;properties&quot;: {</div>
<div class="line">    &quot;value&quot;: {</div>
<div class="line">      &quot;type&quot;: &quot;array&quot;,</div>
<div class="line">      &quot;items&quot;: {</div>
<div class="line">        &quot;$ref&quot;: &quot;#/definitions/Binding Table Entry&quot;</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  },</div>
<div class="line">  &quot;required&quot;:[&quot;value&quot;]</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md150"></a>
Discovering what can be bound</h3>
<p>Protocol Controller MUST advertise the list of available Clusters for binding for each PAN node. The <em>BindableClusterList</em> attribute indicates an array of Cluster IDs that can be used for Binding Commands.</p>
<p>If the list of Cluster IDs that can be bound is unknown to the Protocol Controller, it MUST NOT publish any Binding capabilities for that UNID/Endpoint.</p>
<div class="fragment"><div class="line">ucl/by-unid/&lt;UNID&gt;/ep&lt;EndpointId&gt;/Binding/Attributes/BindableClusterList/Desired { &quot;value&quot;: [&quot;OnOff&quot;, &quot;Level&quot;]}</div>
<div class="line">ucl/by-unid/&lt;UNID&gt;/ep&lt;EndpointId&gt;/Binding/Attributes/BindableClusterList/Reported { &quot;value&quot;: [&quot;OnOff&quot;, &quot;Level&quot;]}</div>
</div><!-- fragment --><p>The JSON schema for this topic MUST be as follows:</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  &quot;$schema&quot;: &quot;http://json-schema.org/draft-07/schema#&quot;,</div>
<div class="line">  &quot;title&quot;: &quot;Binding Cluster ID list&quot;,</div>
<div class="line">  &quot;description&quot;: &quot;Binding Cluster ID list&quot;,</div>
<div class="line">  &quot;type&quot;: &quot;object&quot;,</div>
<div class="line">  &quot;properties&quot;: {</div>
<div class="line">    &quot;value&quot;: {</div>
<div class="line">      &quot;type&quot;: &quot;array&quot;,</div>
<div class="line">      &quot;items&quot;: {</div>
<div class="line">        &quot;type&quot;: &quot;string&quot;,</div>
<div class="line">        &quot;minLength&quot;: 1</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  },</div>
<div class="line"> </div>
<div class="line">  &quot;required&quot;:[&quot;value&quot;]</div>
<div class="line">}</div>
</div><!-- fragment --><p>IoT Service SHOULD NOT attempt to bind a node to a destination, if the destination does not have any Attributes or SupportedCommands for the Cluster used in the binding.</p>
<p>Protocol Controller MUST reject bindings if the destination cannot receive commands from the cluster defined in the binding.</p>
<h1><a class="anchor" id="autotoc_md151"></a>
Binding levels</h1>
<p>When a binding is estalished in the Unify system, it is possible that the 2 nodes cannot communicate directly with each other.</p>
<p>Therefore, an IoT Service requesting to Bind 2 nodes can lead to 3 (hidden) substates</p>
<ul>
<li><p class="startli"><b>Direct PAN binding</b></p>
<p class="startli">When such a binding is established, 2 nodes will communicate directly with each other and no Protocol Controller will be involved.</p>
</li>
<li><p class="startli"><b>Intra Protocol Controller binding</b></p>
<p class="startli">The 2 nodes cannot communicate directly with each other, but are serviced by the same Protocol Controller and therefore the Protocol Controller can "relay" messages.</p>
</li>
<li><p class="startli"><b>Inter Protocol Controller binding</b></p>
<p class="startli">The 2 nodes have 2 different Protocol Controllers and therefore the Protocol Controllers will need to send commands to each other to make the binding work.</p>
</li>
</ul>
<p>Both Intra and Inter Protocol Controller Bindings may be treated the same way by a Protocol Controller, which can publish a Command to the destination UNID/Ep using the MQTT command space.</p>
<p>If the Protocol Controller itself is servicing the destination, it will receive its own command publication and proceed with sending the command to the destination.</p>
<div class="plantumlgraph">
<img src="inline_umlgraph_28.png" />
</div>
<p>Protocol Controllers are not mandated to support creating Intra or Inter Protocol Controller bindings. In this case, it will appear from the IoT Service as if the Bind command was ignored or rejected.</p>
<h2><a class="anchor" id="autotoc_md152"></a>
Binding table capacity</h2>
<p>A PAN node may have a limited capacity in its binding table. When that happens, a protocol controller can use the <em>BindingTableFull</em> attribute to indicate that we have reached the limit, and no more bindings can be made.</p>
<div class="fragment"><div class="line">ucl/by-unid/&lt;UNID&gt;/ep&lt;EndpointId&gt;/Binding/Attributes/BindingTableFull/Reported {&quot;value&quot;: true}</div>
</div><!-- fragment --><p>Note that Protocol Controllers MAY start establishing Intra Protocol Controller bindings when the capacity of the PAN node is reached. In this case, the Protocol Controller MUST NOT advertise that the binding table is full.</p>
<p>A Protocol Controller establishing Intra Protocol Controller Bindings MUST advertise that the Binding table is full only if both the PAN node and the Protocol Controller have exhausted their binding capacity.</p>
<h2><a class="anchor" id="autotoc_md153"></a>
MQTT publications example</h2>
<p>An example of a PAN node with the Bindings server PAN node able to send commands for the OnOff and Level clusters will be shown as follows:</p>
<div class="fragment"><div class="line">ucl/by-unid/&lt;UNID&gt;/ep&lt;EndpointId&gt;/Binding/Attributes/BindingTableFull/Reported {&quot;value&quot;: false}</div>
<div class="line">ucl/by-unid/&lt;UNID&gt;/ep&lt;EndpointId&gt;/Binding/Attributes/BindingTableFull/Desired {&quot;value&quot;: false}</div>
<div class="line">ucl/by-unid/&lt;UNID&gt;/ep&lt;EndpointId&gt;/Binding/Attributes/BindableClusterList/Reported {&quot;value&quot;: [&quot;OnOff&quot;, &quot;Level&quot;]}</div>
<div class="line">ucl/by-unid/&lt;UNID&gt;/ep&lt;EndpointId&gt;/Binding/Attributes/BindableClusterList/Desired {&quot;value&quot;: [&quot;OnOff&quot;, &quot;Level&quot;]}</div>
<div class="line">ucl/by-unid/&lt;UNID&gt;/ep&lt;EndpointId&gt;/Binding/Attributes/BindingTable/Reported {&quot;value&quot;: []}</div>
<div class="line">ucl/by-unid/&lt;UNID&gt;/ep&lt;EndpointId&gt;/Binding/Attributes/BindingTable/Desired {&quot;value&quot;: []}</div>
<div class="line">ucl/by-unid/&lt;UNID&gt;/ep&lt;EndpointId&gt;/Binding/SupportedCommands {&quot;value&quot;: [&quot;Bind&quot;,&quot;Unbind&quot;]}</div>
<div class="line">ucl/by-unid/&lt;UNID&gt;/ep&lt;EndpointId&gt;/Binding/SupportedGeneratedCommands {&quot;value&quot;: []}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md154"></a>
Detailed examples</h2>
<h3><a class="anchor" id="autotoc_md155"></a>
Happy case</h3>
<div class="plantumlgraph">
<img src="inline_umlgraph_29.png" />
</div>
<h3><a class="anchor" id="autotoc_md156"></a>
Failed binding attempts</h3>
<div class="plantumlgraph">
<img src="inline_umlgraph_30.png" />
</div>
<h3><a class="anchor" id="autotoc_md157"></a>
Explicit binding towards a Protocol Controller</h3>
<p>IoT Service MAY use the binding cluster to force binding towards a Protocol Controller. The Binding cluster provides a special command for this, so IoT services do not need to figure out which UNID/ep to use for the Binding to point at the Protocol Controller.</p>
<p>Protocol Controllers supporting to establish bindings towards themselves SHOULD forward commands received by PAN nodes to IoT Services using the <b>ucl/by-unid/&lt;unid&gt;/ep&lt;id&gt;/&lt;ClusterName&gt;/GeneratedCommands</b> topic space.</p>
<p>The diagram below shows an example of an explicit binding to the Protocol Controller.</p>
<div class="plantumlgraph">
<img src="inline_umlgraph_31.png" />
</div>
 </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>

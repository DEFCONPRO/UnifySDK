<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Unify SDK User Guide: AoX Positioning User Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Unify SDK User Guide
   &#160;<span id="projectnumber">1.1.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_applications_aox_applications_positioning_readme_user.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">AoX Positioning User Guide </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This user guide will guide the reader on how to install, configure and run the Positioning IoT Service.</p>
<p>Readers of this document should be familiar with the <a class="el" href="md_applications_aox_applications_aoxpc_readme_user.html">AoXPC</a>, because the position estimation service is based on the angle data provided by the AoXPC instances.</p>
<h1><a class="anchor" id="autotoc_md482"></a>
Operation</h1>
<p>The positioning service starts automatically as a systemd service. For more information on installation and systemd services, see <a class="el" href="md_doc_readme_user.html">Unify User guide</a>.</p>
<p>The service detects the locators connected to the system automatically. Locators need to be configured as described in the <a class="el" href="md_applications_aox_applications_aoxpc_readme_user.html">AoXPC User Guide</a>. The locator configuration is considered valid if the <code>PositionAndOrientationValid</code> attribute is set to <code>true</code>.</p>
<p>Once a locator is configured, there is no way to exclude it from the position estimation. Only one positioning service is supported per MQTT broker.</p>
<p>Asset tags are presented as individual nodes on the MQTT network by the positioning service. The estimated position of the asset tag is presented as an AoXPositionEstimation cluster attribute, as follows.</p>
<div class="fragment"><div class="line">ucl/by-unid/&lt;TAG_UNID&gt;/ep0/AoXPositionEstimation/Attributes/Position/Reported {</div>
<div class="line">  &quot;value&quot;: {</div>
<div class="line">    &quot;ApplicationId&quot;: &quot;positioning_4154&quot;,</div>
<div class="line">    &quot;DeviationX&quot;: 3.1297969818115234,</div>
<div class="line">    &quot;DeviationY&quot;: 0.6999226212501526,</div>
<div class="line">    &quot;DeviationZ&quot;: 3.8446271419525146,</div>
<div class="line">    &quot;Sequence&quot;: 47021,</div>
<div class="line">    &quot;X&quot;: 0.8519021272659302,</div>
<div class="line">    &quot;Y&quot;: 0.000349800189724192,</div>
<div class="line">    &quot;Z&quot;: 0.8335742950439453</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md483"></a>
Position Estimation with One Locator</h2>
<p>The positioning service allows to estimate position even with one locator. To achieve this, RSSI based distance estimation is used. If the received signal strength of the incoming signal is altered for any other reason than the distance between the TX and RX itself, it will lead to incorrect distance measurement and it will lead to incorrect position estimates.</p>
<p>Therefore, using multiple locators is advised for accurate position estimation.</p>
<h1><a class="anchor" id="autotoc_md484"></a>
Configuration</h1>
<p>The positioning service can be configured with the same JSON config file as the AoXPC. The path of the config file can be specified with the <code>--positioning.config</code> CLI option.</p>
<p>These are the configuration parameters that are relevant for the positioning service, with their default values:</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  &quot;id&quot;:&quot;positioning_&lt;PID&gt;&quot;,</div>
<div class="line">  &quot;estimationModeLocation&quot;:&quot;SL_RTL_LOC_ESTIMATION_MODE_THREE_DIM_HIGH_ACCURACY&quot;,</div>
<div class="line">  &quot;validationModeLocation&quot;:&quot;SL_RTL_LOC_MEASUREMENT_VALIDATION_MEDIUM&quot;,</div>
<div class="line">  &quot;estimationIntervalSec&quot;:0.02,</div>
<div class="line">  &quot;locationFiltering&quot;:true,</div>
<div class="line">  &quot;locationFilteringWeight&quot;:0.1,</div>
<div class="line">  &quot;numberOfSequenceIds&quot;:6,</div>
<div class="line">  &quot;maximumSequenceIdDiffs&quot;:20,</div>
<div class="line">}</div>
</div><!-- fragment --><p>Let's see these parameters in detail. </p>
<h2><a class="anchor" id="autotoc_md485"></a>
id</h2>
<p>This parameter controls the <code>ApplicationId</code> field of the <code>Position</code> attribute. The default value is derived from the process ID. It can be replaced with any string.</p>
<h2><a class="anchor" id="autotoc_md486"></a>
estimationModeLocation</h2>
<p>Estimation mode used by the position estimation algorithm.</p>
<p>For more details, see <a href="https://docs.silabs.com/rtl-lib/latest/group-sl-rtl-loc#gacf5978113a013aa36cbdb85bfc937aed">sl_rtl_loc_set_mode</a>.</p>
<h2><a class="anchor" id="autotoc_md487"></a>
validationModeLocation</h2>
<p>The positioning service implements an angle correction mechanism for a deviating locator whose angle reports are far off the expected one, and thus is not pointing to the same direction where all other locators see the tag. The correction feedback provides the locator with the information in which direction it is supposed to see the tag. This helps locators that locked up on a reflection signal which is stronger than the one coming in the line-of sight direction.</p>
<p>The <code>validationModeLocation</code> parameter determines the sensitivity of the angle correction mechanism.</p>
<p>For more details, see <a href="https://docs.silabs.com/rtl-lib/latest/group-sl-rtl-loc#ga424290857cf7416aef48d72ed31d84a2">sl_rtl_loc_set_measurement_validation</a>.</p>
<h2><a class="anchor" id="autotoc_md488"></a>
estimationIntervalSec</h2>
<p>Estimation interval in seconds. This value should approximate the time interval between two consecutive CTEs received from an asset tag.</p>
<p>For more details, see <a href="https://docs.silabs.com/rtl-lib/latest/group-sl-rtl-loc#gaa2a04c7e40ec23d2451cd63d0a6024db">sl_rtl_loc_process</a>.</p>
<h2><a class="anchor" id="autotoc_md489"></a>
locationFiltering, locationFilteringWeight</h2>
<p>An optional filter can be applied on the position coordinates, <code>X</code>, <code>Y</code> and <code>Z</code> to reduce noise. Filter weight ranges from 0 to 1.</p>
<p>For more details, see <a href="https://docs.silabs.com/rtl-lib/latest/group-sl-rtl-util#ga41610abd68f01bc6871e084fc28ed000">sl_rtl_util_filter</a>.</p>
<h2><a class="anchor" id="autotoc_md490"></a>
numberOfSequenceIds, maximumSequenceIdDiffs</h2>
<p>The CTE signals can be identified by their sequence ID which is a monotonic increasing number. When the positioning service receives an angle report estimated from that CTE, it knows</p><ul>
<li>the transmitter of the CTE (asset tag)</li>
<li>the receiver of the CTE (locator)</li>
<li>the sequence ID of the CTE.</li>
</ul>
<p>Ideally, a CTE signal is processed by all of the locators in the AoA system, so the positioning service simply has to wait for all angle reports from all locators with a given sequence ID. Once all angle reports have arrived, the positioning can start the position estimation. But what happens if a CTE is missed by a locator, or a locator is temporarily unavailable?</p>
<p>The <code>angle_queue</code> component is responsible for collecting the angle reports that belong to the same CTE (i.e., have the same sequence ID) and go on with position estimation even under suboptimal conditions. <code>numberOfSequenceIds</code> and <code>maximumSequenceIdDiffs</code> can be used to tweak the behavior of the <code>angle_queue</code> component.</p>
<p>The <code>numberOfSequenceIds</code> tells how many sequence IDs shall be tracked maximum for a given asset tag. If <code>numberOfSequenceIds</code> is exceeded, the angle reports with the oldest sequence ID are deleted. This parameter also determines the number of angle reports the positioning has to wait for before starting the position estimation. The expected angle count depends on the "age" of the sequence ID in a linear way. This means, Only 2 angle reports are expected for the oldest sequence ID, for the newest sequence ID all locators are expected to send an angle report. In the following example, we have 7 locators, <code>numberOfSequenceIds</code> is 6.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Slot  </th><th class="markdownTableHeadNone">0  </th><th class="markdownTableHeadNone">1  </th><th class="markdownTableHeadNone">2  </th><th class="markdownTableHeadNone">3  </th><th class="markdownTableHeadNone">4  </th><th class="markdownTableHeadNone">5   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Sequence ID  </td><td class="markdownTableBodyNone">101  </td><td class="markdownTableBodyNone">102  </td><td class="markdownTableBodyNone">103  </td><td class="markdownTableBodyNone">104  </td><td class="markdownTableBodyNone">105  </td><td class="markdownTableBodyNone">106   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Angles expected  </td><td class="markdownTableBodyNone">2  </td><td class="markdownTableBodyNone">3  </td><td class="markdownTableBodyNone">4  </td><td class="markdownTableBodyNone">5  </td><td class="markdownTableBodyNone">6  </td><td class="markdownTableBodyNone">7   </td></tr>
</table>
<p><code>maximumSequenceIdDiffs</code> sets another limit on the sequence IDs. If the sequence ID difference between the oldest and the newest angle report exceeds this limit, then the angle reports with the oldest sequence ID are deleted. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Wed Mar 23 2022 08:49:23 for Unify SDK User Guide by <a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>

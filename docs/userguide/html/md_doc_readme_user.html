<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Unify SDK User Guide: Unify User guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Unify SDK User Guide
   &#160;<span id="projectnumber">1.1.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_doc_readme_user.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Unify User guide </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This guide contains information which is common to all Unify applications Details about each application can be found in the application specific user guides</p>
<h1><a class="anchor" id="autotoc_md69"></a>
Prerequisites</h1>
<p>Before installing the Unify SDK components on a Raspberry Pi 4 (RPi4), the following prerequisites shall be fulfilled:</p>
<ul>
<li>An RPi4 preinstalled with <a href="https://downloads.raspberrypi.org/raspbian/images/raspbian-2020-02-14">Raspberry Pi OS Linux Version 10, Buster</a></li>
<li>One of the following, supported wireless radios is connected to the RPi4 via USB:<ul>
<li>UZB 7 serial dongle for Z-Wave</li>
<li>EFR32MG12 running NCP Firmware for ZigBee</li>
<li>EFR32xG22 running NCP Firmware for AoXPC</li>
</ul>
</li>
</ul>
<p>If these prerequisites are not fulfilled, follow the setup instructions in the <a href="https://projects.raspberrypi.org/en/projects/raspberry-pi-setting-up">Official Raspberry Pi User Guide</a>, and ensure a supported radio module is attached to your RPi4.</p>
<p>It also is required to add mosquitto PPA on the RPi4 to get mosquitto version which is above 2.0 to support MQTTv5:</p>
<div class="fragment"><div class="line"># Add mosquitto PPA to get mosquitto &gt; 2.0 to support MQTTv5</div>
<div class="line">curl -s http://repo.mosquitto.org/debian/mosquitto-repo.gpg.key | sudo apt-key add -</div>
<div class="line">sudo curl -s  http://repo.mosquitto.org/debian/mosquitto-buster.list -o /etc/apt/sources.list.d/mosquitto-buster.list</div>
<div class="line">sudo apt update</div>
<div class="line">sudo apt install mosquitto mosquitto-clients</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md70"></a>
Installation</h1>
<p>The Unify distribution is targeted a Debian Buster platform. A binary debian packages for a raspberry pi 4 are provided with the SDK and they are available on github <a href="https://github.com/SiliconLabs/UnifySDK/releases">release page</a>.</p>
<p>The simplest way to install the Unify components is to use the <code>apt</code> tool. Transfer the .deb packages to the target via eg. SCP. Make sure to use either a local relative path with './' or an absolute paths. Otherwise apt will look for the package in the wrong place and fail. For example:</p>
<div class="fragment"><div class="line">sudo apt install uic-&lt;component&gt;_&lt;version&gt;_armhf.deb</div>
</div><!-- fragment --><p>or for installing all components</p>
<div class="fragment"><div class="line">sudo apt install ./uic-sdk-dir/*.deb</div>
</div><!-- fragment --><p>or for updating previously installed packages to a newer version</p>
<div class="fragment"><div class="line">sudo apt reinstall ./uic-sdk-dir/*.deb</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md71"></a>
Evaluation</h1>
<p>Once all Unify Application components are installed and configured, one can evaluate the system via running IoT service such as Unify dev_gui. Note that the raspberry pi needs to be rebooted after installing the debian packages for the first time.</p>
<p>After a reboot the Unify dev_gui can be accessed from a browser on <a href="http://raspberrypi.local:3080">http://raspberrypi.local:3080</a>.</p>
<p><em>Note</em> that the Unify user interface needs TCP access to the port 3080 and 1337 on the Raspberry Pi.</p>
<p>See the <a class="el" href="md_applications_dev_ui_dev_gui_readme_user.html">Dev-GUI manual</a> for more information about using this interface. </p>
<h1><a class="anchor" id="autotoc_md72"></a>
Running Using Systemd</h1>
<p>Normally, the Unify components should be run as a service. When the debian packages are installed they automatically enables themselves as systemd services.</p>
<p>The the components can be started and stopped using the <code>systemctl</code> command (see systemctl linux manual for details).</p>
<div class="fragment"><div class="line">sudo systemctl start uic-&lt;component-name&gt;</div>
<div class="line">sudo systemctl stop uic-&lt;component-name&gt;</div>
</div><!-- fragment --><p>To see the logs of the the components when it runs as a service, use the following command:</p>
<div class="fragment"><div class="line">journalctl -u uic-&lt;component-name&gt;.service</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md73"></a>
Configuring Unify Components</h1>
<p>Configuration parameters for the unify components can be specified in two different ways.</p>
<h1><a class="anchor" id="autotoc_md74"></a>
Configuring logging</h1>
<p>The logging of each unify component can be controlled by the two common configuration parameters, <b>log.level</b> and <b>log.tag_level</b>-</p>
<p>When a component starts, the log is printed to stdout, as follows:</p>
<div class="fragment"><div class="line">+ 2020-11-11 14:18:52:276827 &lt;d&gt; [sl_log] Setting log level to debug</div>
<div class="line">+ 2020-11-11 14:18:52:277573 &lt;d&gt; [uic_component_fixtures] Completed: UIC Signal Handler</div>
<div class="line">+ 2020-11-11 14:18:52:277631 &lt;d&gt; [mqtt_client] Constructing new mqtt_client instance.</div>
<div class="line">+ 2020-11-11 14:18:52:277696 &lt;d&gt; [mqtt_wrapper_mosquitto] Initializing Mosquitto library.</div>
</div><!-- fragment --><p>The general log format is as follows:</p>
<div class="fragment"><div class="line">&lt;timestamp&gt; &lt;severity&gt; [tag] &lt;message&gt;</div>
</div><!-- fragment --><p>The log level can be set globally and per tag.</p>
<p>For example:</p>
<div class="fragment"><div class="line">zpc  --log.level i --log.tag_level uic_component_fixtures:d,mqtt_client:d</div>
</div><!-- fragment --><p>This will set the global log level to info but it enables the debug on the two components such as the following: mqtt_client and uic_component_fixtures.</p>
<h2><a class="anchor" id="autotoc_md75"></a>
How to configure logs rotation</h2>
<p>The Unify services logs ends two places. First the journald system deamon services the logs. In addition the logs are also dumped in the <code>/var/log/syslog.log</code>. Journald will automatically rotate logs and not overload the system with logs.</p>
<h3><a class="anchor" id="autotoc_md76"></a>
Configure Journalctl</h3>
<p>Unify uses systemd-journald system for logging. It should be configured with <code>/etc/systemd/journald.conf</code> file. This file contains several parameters, but we only need a few. For detailed description, please follow <a href="https://man7.org/linux/man-pages/man5/journald.conf.5.html">man journald.conf(5)</a>. Also, you should know there are two logs storages in Linux: <b>persistent</b> and <b>volatile</b>. Settings for each of them are configured separatelly. Parameters, started with <code>System</code> applies to persistent storage, located in <code>/var/log/</code>. Parameters, started with <code>Runtime</code> applies to volatile storage, located in <code>/run/log/journal</code>. </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Parameter  </th><th class="markdownTableHeadNone">Description   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">SystemMaxUse, RuntimeMaxUse  </td><td class="markdownTableBodyNone">how much disk space the journal may use up at most   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">SystemKeepFree, RuntimeKeepFree  </td><td class="markdownTableBodyNone">how much disk space journald shall leave free for other uses   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">SystemMaxFileSize, RuntimeMaxFileSize  </td><td class="markdownTableBodyNone">how large individual journal files may grow at most   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">SystemMaxFiles, RuntimeMaxFiles  </td><td class="markdownTableBodyNone">how many individual journal files to keep at most   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">MaxFileSec  </td><td class="markdownTableBodyNone">the maximum time to store entries in a single journal file before rotating to the next one   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">MaxRetentionSec  </td><td class="markdownTableBodyNone">the maximum time to store journal files before deletion even if there is enough free space   </td></tr>
</table>
<p>For disk space parameters (<code>SystemMaxUse</code>, <code>SystemKeepFree</code>, <code>SystemMaxFileSize</code>) specify values in bytes or use <em>K, M, G, T, P, E</em> as multipliers.</p>
<p>For time parameters (<code>MaxFileSec</code>, <code>MaxRetentionSec</code>) specify values in seconds or use _"year", "month", "week", "day", "h"_ or _"m"_ as multipliers. Set the parameter value to <code>0</code> to turn off this feature.</p>
<h3><a class="anchor" id="autotoc_md77"></a>
Configure log rotation syslog</h3>
<p>If you have enabled debug logging of the Unify SDK packages. Chances are you will quite fast load up some big log files in syslog. To mitigate this you can change the log rotation in the syslog logrotation file <code>/etc/logrotate.d/rsyslog</code>. Documentation on log rotation settings can be found <a href="https://manpages.debian.org/stretch/logrotate/logrotate.8.en.html">here</a>.</p>
<h1><a class="anchor" id="autotoc_md78"></a>
Setting up Mosquitto</h1>
<p>The Unify framework need to the mosquitto MQTT broker to work. For this reason mosquitto is a dependency of all the provided debian packages. The Unify framework works with the default mosquitto installation but it may be desireable to change the mosquito broker installation, eg. to enable TLS support.</p>
<p>Configure the Mosquitto broker with the following parameters to enable TLS support. Mosquitto can support TLS and non-TLS communication simultaneously on two different ports. For example, in the following mosquitto.conf, Mosquitto Broker will accept non-TLS communication on port 1883.</p>
<h2><a class="anchor" id="autotoc_md79"></a>
mosquitto.conf</h2>
<div class="fragment"><div class="line">port 1883</div>
<div class="line">allow_anonymous true</div>
<div class="line">per_listener_settings true</div>
<div class="line"> </div>
<div class="line">listener 8883</div>
<div class="line">cafile ca/ca.crt</div>
<div class="line">certfile broker/broker.crt</div>
<div class="line">keyfile broker/broker.key</div>
<div class="line">require_certificate true</div>
</div><!-- fragment --><p>Having the config options: <code>"cafile" (client/ca.crt)</code>, <code>"certfile" (broker/broker.crt)</code> and <code>"keyfile" (broker/broker.key)</code> in Mosquitto Broker config file will make the Mosquitto Broker communicate with Unify components with TLS encryption.</p>
<p>For the purpose of testing a script <code>tls-certificates-generation.sh</code> has been provided to create test certificates, for a TLS connection between the Unify components and Mosquitto Broker.</p>
<blockquote class="doxtable">
<p>WARNING: Don't use this this script in making production certificates </p>
</blockquote>
<div class="fragment"><div class="line">scripts/tls-certificates-generation.sh &lt;broker IP/hostname&gt;</div>
</div><!-- fragment --><p><em>localhost</em> may be provided when the MQTT broker and Unify Components are running on the same machine. The script will output the following files:</p>
<div class="fragment"><div class="line">$ tree .</div>
<div class="line">| broker</div>
<div class="line">   | broker.crt</div>
<div class="line">   | broker.key</div>
<div class="line">| ca</div>
<div class="line">   | ca.crt</div>
<div class="line">   | ca.key</div>
<div class="line">   | ca.srl</div>
<div class="line">| client</div>
<div class="line">    | client.crt</div>
<div class="line">    | client.key</div>
</div><!-- fragment --><p>Each Unify component must use the <em>mqtt.cafile</em>, <em>mqtt.certfile</em> and <em>mqtt.keyfile</em> options to enable the TLS encrypted connection. The option can be provided from command line or from the config file of the components.</p>
<p>&gt;NOTE: the DevUI will need the certificates as input from the user interface itself.</p>
<h1><a class="anchor" id="autotoc_md80"></a>
Evaluation</h1>
<p>Once all Unify Application components are installed and configured, one can evaluate the system via running IoT service such as Unify dev_gui.</p>
<p>The Unify dev_gui can be accessed from a browser on <a href="http://raspberrypi.local:3080">http://raspberrypi.local:3080</a>.</p>
<p><em>Note</em> that the Unify user interface needs TCP access to the port 3080 and 1337 on the Raspberry Pi.</p>
<p>See the <a class="el" href="md_applications_dev_ui_dev_gui_readme_user.html">Dev-GUI manual</a> for more information about using this interface. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Wed Mar 23 2022 08:49:23 for Unify SDK User Guide by <a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>

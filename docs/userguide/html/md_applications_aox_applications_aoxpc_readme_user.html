<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Unify SDK User Guide: AoXPC User Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Unify SDK User Guide
   &#160;<span id="projectnumber">1.1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_applications_aox_applications_aoxpc_readme_user.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">AoXPC User Guide </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This user guide will guide the reader on how to install, configure and run the Angle of Arrival/Departure Protocol Controller (AoXPC).</p>
<p>Readers of this document should be familiar with the basics and terms of Direction Finding. To learn more about the theory of Direction Finding, see <a href="https://www.silabs.com/documents/public/user-guides/ug103-18-bluetooth-direction-finding-fundamentals.pdf">UG103.18: Bluetooth Direction Finding Fundamentals</a>.</p>
<p>To get started with Silicon Labs Direction Finding Solution, see <a href="https://www.silabs.com/documents/public/quick-start-guides/qsg175-direction-finding-solution-quick-start-guide.pdf">QSG175: Silicon Labs Direction Finding Solution Quick-Start Guide</a>. This document explains how to prepare the radio boards with the necessary firmware images.</p>
<h1><a class="anchor" id="autotoc_md423"></a>
Limitations</h1>
<ul>
<li>AoX stands for both Bluetooth Low Energy 5.1 direction finding features, Angle of Arrival (AoA) and Angle of Departure (AoD). As of now, AoXPC supports only AoA but not AoD.</li>
<li>The asset tags in the AoA setup are considered to be homogeneous, i.e., every asset tag should operate with the same CTE type (Connection, Connectionless or Silicon Labs proprietary).</li>
<li>The Unify specification describes 2 reporting modes, IQReport and AngleReport. As of now, AoXPC supports only AngleReport.</li>
</ul>
<h1><a class="anchor" id="autotoc_md424"></a>
Operation</h1>
<h2><a class="anchor" id="autotoc_md425"></a>
Running AoXPC From the Command Line</h2>
<p>The AoXPC can be started either from command line, or as a system service. Running AoXPC as a system service is supported if there is only one locator radio connected to the system.</p>
<div class="fragment"><div class="line">sudo systemctl start uic-aoxpc</div>
</div><!-- fragment --><p>For more information, see <a class="el" href="md_doc_readme_user.html">Unify User guide</a>.</p>
<p>If the system hosts several locators, an AoXPC can be started for each locator from the command line.</p>
<div class="fragment"><div class="line">aoxpc --aoxpc.ncp.serial /dev/ttyACM1 --aoxpc.datastore_file aoxpc_1.db</div>
</div><!-- fragment --><blockquote class="doxtable">
<p>NOTE: Make sure to select separate datastore files for each locator. </p>
</blockquote>
<p>A datastore file can be used only by one aoxpc instance at once.</p>
<h2><a class="anchor" id="autotoc_md426"></a>
NCP Connection</h2>
<p>In the AoA locator radios, the Bluetooth stack runs in a so called Network Co-Processor (NCP) mode. There are 2 ways to set up an NCP connection with the locator, either via serial port or via TCP/IP. The connection parameters can be specified with the following CLI options:</p>
<div class="fragment"><div class="line">--aoxpc.ncp.serial arg (=/dev/ttyACM0)</div>
<div class="line">                                      Serial port where NCP module is </div>
<div class="line">                                      connected</div>
<div class="line">--aoxpc.ncp.baud_rate arg (=115200)   Baud rate of the serial connection</div>
<div class="line">--aoxpc.ncp.tcp arg                   TCP address of the connection</div>
</div><!-- fragment --><p>If the <code>aoxpc.ncp.tcp</code> is given, it takes precedence over the serial port.</p>
<p>To learn more about NCP mode, see <a href="https://www.silabs.com/documents/public/application-notes/an1259-bt-ncp-mode-sdk-v3x.pdf">AN1259: Using the v3.x Silicon Labs Bluetooth Stack in Network Co-Processor Mode</a>.</p>
<h1><a class="anchor" id="autotoc_md427"></a>
Configuration</h1>
<p>There are 2 ways for controlling the configuration parameters of the AoXPC.</p>
<ol type="1">
<li>JSON configuration file</li>
<li>AoXLocator cluster attributes</li>
</ol>
<h2><a class="anchor" id="autotoc_md428"></a>
JSON Configuration File</h2>
<p>This option provides access to the complete list of the available configuration parameters. The path of the JSON config file can be set with the <code>--aoxpc.config</code> option. The format and the available configuration parameters are documented in the <a href="https://www.silabs.com/documents/public/application-notes/an1296-application-development-with-rtl-library.pdf">AN1296: Application Development with Silicon Labsâ€™ RTL Library</a> in chapters <em>3.3 AoA Locator Configuration</em>, and <em>4.1 Positioning Configuration</em>.</p>
<h2><a class="anchor" id="autotoc_md429"></a>
AoXLocator Cluster Attributes</h2>
<p>A subset of the configuration parameters are also available as attributes of the AoXLocator cluster. These attributes can be written by a remote client with the <code>WriteAttributes</code> command. Once written, these attributes are stored in the persistent storage and get restored from the datastore file upon startup.</p>
<h2><a class="anchor" id="autotoc_md430"></a>
Configuration Precedence</h2>
<p>If the JSON configuration file is provided, it always take precedence over the AoXLocator cluster attributes. If neither JSON configuration file is present, nor the AoXLocator cluster attributes are written, then the default value of the configuration parameters come to effect.</p>
<h2><a class="anchor" id="autotoc_md431"></a>
Configure AoXPC for Position Estimation</h2>
<p>In order to operate the Positioning IoT Service, the coordinate and the orientation of the AoXPC has to be configured. This task might be trivial for 2 locators, but the complexity can grow quickly with the number of locators.</p>
<p>AoA Configurator is a graphical tool shipped with Simplicity Studio that simplifies this process by providing an editable 3D representation of your topology and locator devices. See <a href="https://www.silabs.com/documents/public/user-guides/ug514-using-bluetooth-direction-finding-tool-suite.pdf">UG514: Using the Bluetooth Direction Finding Tool Suite</a> chapter <em>4.2 AoA Configurator</em> for details.</p>
<p>When the topology is configured, the result can be exported as a JSON configuration file as described in chapter <em>3.5 Import &amp; Export: Migrating Configuration Files</em>.</p>
<h2><a class="anchor" id="autotoc_md432"></a>
Configuration Example</h2>
<p>After determining the topology of the locators, let's see the 2 different configuration methods in action. These methods will give the exact same result.</p>
<h3><a class="anchor" id="autotoc_md433"></a>
Using JSON configuration file</h3>
<p>Save the following file as <code>my_aox_config.json</code>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  &quot;locators&quot;: [</div>
<div class="line">    {</div>
<div class="line">      &quot;id&quot;: &quot;ble-pd-111111111111&quot;,</div>
<div class="line">      &quot;coordinate&quot;: {</div>
<div class="line">        &quot;x&quot;: 0.0,</div>
<div class="line">        &quot;y&quot;: 0.0,</div>
<div class="line">        &quot;z&quot;: 2.6</div>
<div class="line">      },</div>
<div class="line">      &quot;orientation&quot;: {</div>
<div class="line">        &quot;x&quot;: 180.0,</div>
<div class="line">        &quot;y&quot;: 0.0,</div>
<div class="line">        &quot;z&quot;: 0.0</div>
<div class="line">      }</div>
<div class="line">    },</div>
<div class="line">    {</div>
<div class="line">      &quot;id&quot;: &quot;ble-pd-222222222222&quot;,</div>
<div class="line">      &quot;coordinate&quot;: {</div>
<div class="line">        &quot;x&quot;: 0.0,</div>
<div class="line">        &quot;y&quot;: 4.0,</div>
<div class="line">        &quot;z&quot;: 2.6</div>
<div class="line">      },</div>
<div class="line">      &quot;orientation&quot;: {</div>
<div class="line">        &quot;x&quot;: 180.0,</div>
<div class="line">        &quot;y&quot;: 0.0,</div>
<div class="line">        &quot;z&quot;: 0.0</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  ]</div>
<div class="line">}</div>
</div><!-- fragment --><p>Start the aoxpc instances.</p>
<div class="fragment"><div class="line">aoxpc --aoxpc.config my_aox_config.json --aoxpc.ncp.serial /dev/ttyACM1 --aoxpc.datastore_file aoxpc_1.db</div>
<div class="line">aoxpc --aoxpc.config my_aox_config.json --aoxpc.ncp.serial /dev/ttyACM2 --aoxpc.datastore_file aoxpc_2.db</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md434"></a>
Using AoXLocator cluster attributes</h3>
<p>Start the aoxpc instances.</p>
<div class="fragment"><div class="line">aoxpc --aoxpc.ncp.serial /dev/ttyACM1 --aoxpc.datastore_file aoxpc_1.db</div>
<div class="line">aoxpc --aoxpc.ncp.serial /dev/ttyACM2 --aoxpc.datastore_file aoxpc_2.db</div>
</div><!-- fragment --><p>Write AoXLocator cluster attributes from a remote client.</p>
<div class="fragment"><div class="line">ucl/by-unid/ble-pd-111111111111/ep0/AoXLocator/Commands/WriteAttributes {</div>
<div class="line">  &quot;PositionAndOrientation&quot;: {</div>
<div class="line">    &quot;CoordinateX&quot;: 0.0,</div>
<div class="line">    &quot;CoordinateY&quot;: 0.0,</div>
<div class="line">    &quot;CoordinateZ&quot;: 2.6,</div>
<div class="line">    &quot;OrientationX&quot;: 180.0,</div>
<div class="line">    &quot;OrientationY&quot;: 0.0,</div>
<div class="line">    &quot;OrientationZ&quot;: 0.0</div>
<div class="line">  },</div>
<div class="line">  &quot;PositionAndOrientationValid&quot;: true</div>
<div class="line">}</div>
</div><!-- fragment --><div class="fragment"><div class="line">ucl/by-unid/ble-pd-222222222222/ep0/AoXLocator/Commands/WriteAttributes {</div>
<div class="line">  &quot;PositionAndOrientation&quot;: {</div>
<div class="line">    &quot;CoordinateX&quot;: 0.0,</div>
<div class="line">    &quot;CoordinateY&quot;: 4.0,</div>
<div class="line">    &quot;CoordinateZ&quot;: 2.6,</div>
<div class="line">    &quot;OrientationX&quot;: 180.0,</div>
<div class="line">    &quot;OrientationY&quot;: 0.0,</div>
<div class="line">    &quot;OrientationZ&quot;: 0.0</div>
<div class="line">  },</div>
<div class="line">  &quot;PositionAndOrientationValid&quot;: true</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Wed Feb 9 2022 14:34:00 for Unify SDK User Guide by <a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>

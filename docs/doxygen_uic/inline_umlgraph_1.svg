<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="899px" preserveAspectRatio="none" style="width:1417px;height:899px;background:#FFFFFF;" version="1.1" viewBox="0 0 1417 899" width="1417px" zoomAndPan="magnify"><defs><filter height="300%" id="f1rz4bpc8vzvcg" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><line style="stroke:#A80036;stroke-width:1.0;" x1="177" x2="177" y1="40.2969" y2="381.4141"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="177" x2="177" y1="381.4141" y2="422.2188"/><line style="stroke:#A80036;stroke-width:1.0;" x1="177" x2="177" y1="422.2188" y2="707.8125"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="177" x2="177" y1="707.8125" y2="748.6172"/><line style="stroke:#A80036;stroke-width:1.0;" x1="177" x2="177" y1="748.6172" y2="856.0156"/><line style="stroke:#A80036;stroke-width:1.0;" x1="793" x2="793" y1="40.2969" y2="381.4141"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="793" x2="793" y1="381.4141" y2="422.2188"/><line style="stroke:#A80036;stroke-width:1.0;" x1="793" x2="793" y1="422.2188" y2="707.8125"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="793" x2="793" y1="707.8125" y2="748.6172"/><line style="stroke:#A80036;stroke-width:1.0;" x1="793" x2="793" y1="748.6172" y2="856.0156"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1318" x2="1318" y1="40.2969" y2="381.4141"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1318" x2="1318" y1="381.4141" y2="422.2188"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1318" x2="1318" y1="422.2188" y2="707.8125"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1318" x2="1318" y1="707.8125" y2="748.6172"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1318" x2="1318" y1="748.6172" y2="856.0156"/><rect fill="#FEFECE" filter="url(#f1rz4bpc8vzvcg)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="55" x="148" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="41" x="155" y="24.9951">MQTT</text><rect fill="#FEFECE" filter="url(#f1rz4bpc8vzvcg)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="55" x="148" y="855.0156"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="41" x="155" y="875.0107">MQTT</text><rect fill="#FEFECE" filter="url(#f1rz4bpc8vzvcg)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="109" x="737" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="95" x="744" y="24.9951">DotDot MQTT</text><rect fill="#FEFECE" filter="url(#f1rz4bpc8vzvcg)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="109" x="737" y="855.0156"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="95" x="744" y="875.0107">DotDot MQTT</text><rect fill="#FEFECE" filter="url(#f1rz4bpc8vzvcg)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="109" x="1262" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="95" x="1269" y="24.9951">OnOff Mapper</text><rect fill="#FEFECE" filter="url(#f1rz4bpc8vzvcg)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="109" x="1262" y="855.0156"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="95" x="1269" y="875.0107">OnOff Mapper</text><path d="M137,55.2969 L137,110.2969 L1359,110.2969 L1359,65.2969 L1349,55.2969 L137,55.2969 " fill="#FBFB77" filter="url(#f1rz4bpc8vzvcg)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1349,55.2969 L1349,65.2969 L1359,65.2969 L1349,55.2969 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="301" x="424.5" y="72.3638">In this example only OnOff mappers are shown.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="399" x="424.5" y="87.4966">But there should exist mappers for all supported ZCL Clusters.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="634" x="424.5" y="102.6294">In addition only a selection of the supported commands for each of these mappers are shown here.</text><rect fill="#EEEEEE" filter="url(#f1rz4bpc8vzvcg)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1410" x="0" y="142.5898"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1410" y1="142.5898" y2="142.5898"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1410" y1="145.5898" y2="145.5898"/><rect fill="#EEEEEE" filter="url(#f1rz4bpc8vzvcg)" height="27.7891" style="stroke:#000000;stroke-width:2.0;" width="127" x="641.5" y="129.6953"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="113" x="647.5" y="149.4751">Initialization</text><polygon fill="#A80036" points="804.5,184.6172,794.5,188.6172,804.5,192.6172,800.5,188.6172" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="798.5" x2="1317.5" y1="188.6172" y2="188.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="307" x="810.5" y="183.5513">uic_mqtt_dotdot_on_off_on_callback_set(on_cb)</text><polygon fill="#A80036" points="804.5,213.75,794.5,217.75,804.5,221.75,800.5,217.75" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="798.5" x2="1317.5" y1="217.75" y2="217.75"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="307" x="810.5" y="212.6841">uic_mqtt_dotdot_on_off_off_callback_set(off_cb)</text><polygon fill="#A80036" points="804.5,242.8828,794.5,246.8828,804.5,250.8828,800.5,246.8828" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="798.5" x2="1317.5" y1="246.8828" y2="246.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="415" x="810.5" y="241.8169">uic_mqtt_dotdot_set_on_off_write_attributes_callback(on_att_cb)</text><path d="M683,259.8828 L683,284.8828 L900,284.8828 L900,269.8828 L890,259.8828 L683,259.8828 " fill="#FBFB77" filter="url(#f1rz4bpc8vzvcg)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M890,259.8828 L890,269.8828 L900,269.8828 L890,259.8828 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="196" x="689" y="276.9497">uic_mqtt_dotdot_init() is called</text><polygon fill="#A80036" points="188.5,311.1484,178.5,315.1484,188.5,319.1484,184.5,315.1484" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="182.5" x2="792.5" y1="315.1484" y2="315.1484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="407" x="194.5" y="310.0825">uic_mqtt_subscribe("ucl/by-unid/+/+/OnOff/Commands/On", ...);</text><polygon fill="#A80036" points="188.5,340.2813,178.5,344.2813,188.5,348.2813,184.5,344.2813" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="182.5" x2="792.5" y1="344.2813" y2="344.2813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="407" x="194.5" y="339.2153">uic_mqtt_subscribe("ucl/by-unid/+/+/OnOff/Commands/Off", ...);</text><polygon fill="#A80036" points="188.5,369.4141,178.5,373.4141,188.5,377.4141,184.5,373.4141" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="182.5" x2="792.5" y1="373.4141" y2="373.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="480" x="194.5" y="368.3481">uic_mqtt_subscribe("ucl/by-unid/+/+/OnOff/Commands/WriteAttributes", ...)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="0" x="750" y="405.6245"/><path d="M1232,427.2188 L1232,452.2188 L1401,452.2188 L1401,437.2188 L1391,427.2188 L1232,427.2188 " fill="#FBFB77" filter="url(#f1rz4bpc8vzvcg)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1391,427.2188 L1391,437.2188 L1401,437.2188 L1391,427.2188 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="1238" y="444.2856">An end device is added</text><polygon fill="#A80036" points="804.5,478.4844,794.5,482.4844,804.5,486.4844,800.5,482.4844" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="798.5" x2="1317.5" y1="482.4844" y2="482.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="409" x="810.5" y="477.4185">uic_mqtt_dotdot_publish_supported_commands(unid, endpoint)</text><polygon fill="#A80036" points="1306.5,507.6172,1316.5,511.6172,1306.5,515.6172,1310.5,511.6172" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="793.5" x2="1312.5" y1="511.6172" y2="511.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="501" x="800.5" y="506.5513">on_cb(unid, endpoint, UIC_MQTT_DOTDOT_CALLBACK_TYPE_SUPPORT_CHECK)</text><polygon fill="#A80036" points="1306.5,536.75,1316.5,540.75,1306.5,544.75,1310.5,540.75" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="793.5" x2="1312.5" y1="540.75" y2="540.75"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="501" x="800.5" y="535.6841">off_cb(unid, endpoint, UIC_MQTT_DOTDOT_CALLBACK_TYPE_SUPPORT_CHECK)</text><path d="M739,553.75 L739,668.75 L1372,668.75 L1372,563.75 L1362,553.75 L739,553.75 " fill="#FBFB77" filter="url(#f1rz4bpc8vzvcg)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1362,553.75 L1362,563.75 L1372,563.75 L1362,553.75 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="406" x="812.5" y="570.8169">When uic_mqtt_dotdot_publish_supported_commands is called,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="430" x="812.5" y="585.9497">DotDot MQTT calls all registered OnOff command callback functions</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="387" x="812.5" y="601.0825">with UIC_MQTT_DOTDOT_CALLBACK_TYPE_SUPPORT_CHECK.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="349" x="812.5" y="616.2153">When the Command is supported by the unid/endpoint</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="473" x="812.5" y="631.3481">SL_STATUS_OK shall be returned, otherwise SL_STATUS_NOT_AVAILABLE.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="816.5" y="646.481"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="345" x="812.5" y="661.6138">In this example both callbacks returns SL_STATUS_OK</text><polygon fill="#A80036" points="188.5,695.8125,178.5,699.8125,188.5,703.8125,184.5,699.8125" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="182.5" x2="792.5" y1="699.8125" y2="699.8125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="592" x="194.5" y="694.7466">uic_mqtt_publish("ucl/by-unid/&lt;unid&gt;/ep&lt;x&gt;/OnOff/SupportedCommands", "[\"On\", \"Off\"]")</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="0" x="750" y="732.0229"/><path d="M5,753.6172 L5,778.6172 L347,778.6172 L347,763.6172 L337,753.6172 L5,753.6172 " fill="#FBFB77" filter="url(#f1rz4bpc8vzvcg)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M337,753.6172 L337,763.6172 L347,763.6172 L337,753.6172 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="321" x="11" y="770.6841">IoT Service has published an OnOff/Commands/Off</text><polygon fill="#A80036" points="781.5,804.8828,791.5,808.8828,781.5,812.8828,785.5,808.8828" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="177.5" x2="787.5" y1="808.8828" y2="808.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="305" x="184.5" y="803.8169">uic_mqtt_dotdot_on_on_off_off(topic, message)</text><polygon fill="#A80036" points="1306.5,834.0156,1316.5,838.0156,1306.5,842.0156,1310.5,838.0156" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="793.5" x2="1312.5" y1="838.0156" y2="838.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="445" x="800.5" y="832.9497">on_cb(unid, endpoint, UIC_MQTT_DOTDOT_CALLBACK_TYPE_NORMAL)</text><!--MD5=[fa990df7f086d7a21d10d6ae2373599b]
@startuml inline_umlgraph_1.svg
participant "MQTT" as mqtt
participant "DotDot MQTT" as dotdot
participant "OnOff Mapper" as onoff

note over mqtt, onoff
In this example only OnOff mappers are shown.
But there should exist mappers for all supported ZCL Clusters.
In addition only a selection of the supported commands for each of these mappers are shown here.
end note
=== Initialization ==
onoff    -> dotdot: uic_mqtt_dotdot_on_off_on_callback_set(on_cb)
onoff    -> dotdot: uic_mqtt_dotdot_on_off_off_callback_set(off_cb)
onoff    -> dotdot: uic_mqtt_dotdot_set_on_off_write_attributes_callback(on_att_cb)

note over dotdot: uic_mqtt_dotdot_init() is called

dotdot -> mqtt:     uic_mqtt_subscribe("ucl/by-unid/+/+/OnOff/Commands/On", ...);
dotdot -> mqtt:     uic_mqtt_subscribe("ucl/by-unid/+/+/OnOff/Commands/Off", ...);
dotdot -> mqtt:     uic_mqtt_subscribe("ucl/by-unid/+/+/OnOff/Commands/WriteAttributes", ...)
... ...
note over onoff: An end device is added
onoff -> dotdot:    uic_mqtt_dotdot_publish_supported_commands(unid, endpoint)
dotdot -> onoff:    on_cb(unid, endpoint, UIC_MQTT_DOTDOT_CALLBACK_TYPE_SUPPORT_CHECK)
dotdot -> onoff:    off_cb(unid, endpoint, UIC_MQTT_DOTDOT_CALLBACK_TYPE_SUPPORT_CHECK)

note over dotdot, onoff
When uic_mqtt_dotdot_publish_supported_commands is called,
DotDot MQTT calls all registered OnOff command callback functions
with UIC_MQTT_DOTDOT_CALLBACK_TYPE_SUPPORT_CHECK.
When the Command is supported by the unid/endpoint
SL_STATUS_OK shall be returned, otherwise SL_STATUS_NOT_AVAILABLE.

In this example both callbacks returns SL_STATUS_OK
end note

dotdot -> mqtt:     uic_mqtt_publish("ucl/by-unid/<unid>/ep<x>/OnOff/SupportedCommands", "[\"On\", \"Off\"]")
... ...
note over mqtt: IoT Service has published an OnOff/Commands/Off
mqtt -> dotdot:     uic_mqtt_dotdot_on_on_off_off(topic, message)
dotdot -> onoff:    on_cb(unid, endpoint, UIC_MQTT_DOTDOT_CALLBACK_TYPE_NORMAL)
@enduml

PlantUML version 1.2022.0(Tue Jan 11 16:16:42 UTC 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: ANSI_X3.4-1968
Language: en
Country: US
--></g></svg>
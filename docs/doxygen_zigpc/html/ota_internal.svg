<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1741px" preserveAspectRatio="none" style="width:887px;height:1741px;background:#FFFFFF;" version="1.1" viewBox="0 0 887 1741" width="887px" zoomAndPan="magnify"><defs><filter height="300%" id="f1cdms72lzbec7" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="320" x="280.25" y="28.708">OTA download from image provider</text><rect fill="#FFFFFF" filter="url(#f1cdms72lzbec7)" height="46.2656" style="stroke:#000000;stroke-width:2.0;" width="539" x="301.5" y="121.3828"/><rect fill="#ADD8E6" filter="url(#f1cdms72lzbec7)" height="1293.3359" style="stroke:#000000;stroke-width:2.0;" width="860.5" x="10" y="239.9141"/><rect fill="#ADD8E6" filter="url(#f1cdms72lzbec7)" height="369.2031" style="stroke:#000000;stroke-width:2.0;" width="820.5" x="30" y="466.8438"/><rect fill="#ADD8E6" filter="url(#f1cdms72lzbec7)" height="148.4688" style="stroke:#000000;stroke-width:2.0;" width="800.5" x="40" y="549.2422"/><rect fill="#ADD8E6" height="43.9375" style="stroke:none;stroke-width:1.0;" width="800.5" x="40" y="653.7734"/><rect fill="#ADD8E6" height="102.2031" style="stroke:none;stroke-width:1.0;" width="820.5" x="30" y="733.8438"/><rect fill="#90EE90" height="690.2031" style="stroke:none;stroke-width:1.0;" width="860.5" x="10" y="843.0469"/><rect fill="#90EE90" filter="url(#f1cdms72lzbec7)" height="501.7344" style="stroke:#000000;stroke-width:2.0;" width="840.5" x="20" y="1024.5156"/><rect fill="#90EE90" filter="url(#f1cdms72lzbec7)" height="369.2031" style="stroke:#000000;stroke-width:2.0;" width="820.5" x="30" y="1150.0469"/><rect fill="#90EE90" filter="url(#f1cdms72lzbec7)" height="148.4688" style="stroke:#000000;stroke-width:2.0;" width="800.5" x="40" y="1232.4453"/><rect fill="#90EE90" height="43.9375" style="stroke:none;stroke-width:1.0;" width="800.5" x="40" y="1336.9766"/><rect fill="#90EE90" height="102.2031" style="stroke:none;stroke-width:1.0;" width="820.5" x="30" y="1417.0469"/><rect fill="#FFFFFF" filter="url(#f1cdms72lzbec7)" height="46.2656" style="stroke:#000000;stroke-width:2.0;" width="539" x="301.5" y="1634.6484"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="96" x2="96" y1="75.25" y2="1697.9141"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="347.5" x2="347.5" y1="75.25" y2="1697.9141"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="628.5" x2="628.5" y1="75.25" y2="1697.9141"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="770.5" x2="770.5" y1="75.25" y2="1697.9141"/><rect fill="#FEFECE" filter="url(#f1cdms72lzbec7)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="89" x="50" y="39.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="75" x="57" y="59.9482">OTA cache</text><rect fill="#FEFECE" filter="url(#f1cdms72lzbec7)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="89" x="50" y="1696.9141"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="75" x="57" y="1716.9092">OTA cache</text><rect fill="#FEFECE" filter="url(#f1cdms72lzbec7)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="68" x="311.5" y="39.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="54" x="318.5" y="59.9482">OTA API</text><rect fill="#FEFECE" filter="url(#f1cdms72lzbec7)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="68" x="311.5" y="1696.9141"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="54" x="318.5" y="1716.9092">OTA API</text><rect fill="#FEFECE" filter="url(#f1cdms72lzbec7)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="140" x="556.5" y="39.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="126" x="563.5" y="59.9482">Protocol controller</text><rect fill="#FEFECE" filter="url(#f1cdms72lzbec7)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="140" x="556.5" y="1696.9141"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="126" x="563.5" y="1716.9092">Protocol controller</text><rect fill="#FEFECE" filter="url(#f1cdms72lzbec7)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="116" x="710.5" y="39.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="102" x="717.5" y="59.9482">Image provider</text><rect fill="#FEFECE" filter="url(#f1cdms72lzbec7)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="116" x="710.5" y="1696.9141"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="102" x="717.5" y="1716.9092">Image provider</text><polygon fill="#A80036" points="358.5,102.3828,348.5,106.3828,358.5,110.3828,354.5,106.3828" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="352.5" x2="627.5" y1="106.3828" y2="106.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="162" x="364.5" y="101.3169">subscribe_unid(unid, uiid)</text><path d="M301.5,121.3828 L365.5,121.3828 L365.5,128.3828 L355.5,138.3828 L301.5,138.3828 L301.5,121.3828 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="46.2656" style="stroke:#000000;stroke-width:2.0;" width="539" x="301.5" y="121.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="316.5" y="134.4497">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="183" x="380.5" y="133.5933">[If no unids listening to uiid]</text><polygon fill="#A80036" points="758.5,155.6484,768.5,159.6484,758.5,163.6484,762.5,159.6484" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="347.5" x2="764.5" y1="159.6484" y2="159.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="190" x="354.5" y="154.5825">Subscribe: ucl/OTA/info/uiid/all</text><polygon fill="#A80036" points="758.5,191.7813,768.5,195.7813,758.5,199.7813,762.5,195.7813" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="347.5" x2="764.5" y1="195.7813" y2="195.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="203" x="354.5" y="190.7153">Subscribe: ucl/OTA/info/uiid/unid</text><polygon fill="#A80036" points="107.5,220.9141,97.5,224.9141,107.5,228.9141,103.5,224.9141" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="101.5" x2="346.5" y1="224.9141" y2="224.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="127" x="113.5" y="219.8481">unid listening to uiid</text><path d="M10,239.9141 L74,239.9141 L74,246.9141 L64,256.9141 L10,256.9141 L10,239.9141 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="1293.3359" style="stroke:#000000;stroke-width:2.0;" width="860.5" x="10" y="239.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="25" y="252.981">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="155" x="89" y="252.1245">[specific unid available]</text><rect fill="#EEEEEE" filter="url(#f1cdms72lzbec7)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="880.5" x="0" y="277.6133"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="880.5" y1="277.6133" y2="277.6133"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="880.5" y1="280.6133" y2="280.6133"/><rect fill="#EEEEEE" filter="url(#f1cdms72lzbec7)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="149" x="365.75" y="267.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="130" x="371.75" y="283.1138">image availability</text><polygon fill="#A80036" points="358.5,317.3125,348.5,321.3125,358.5,325.3125,354.5,321.3125" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="352.5" x2="769.5" y1="321.3125" y2="321.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="185" x="364.5" y="316.2466">Publish: ucl/OTA/info/uiid/unid</text><polygon fill="#A80036" points="107.5,346.4453,97.5,350.4453,107.5,354.4453,103.5,350.4453" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="101.5" x2="346.5" y1="350.4453" y2="350.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="227" x="113.5" y="345.3794">Cache image meta info for uiid/unid</text><polygon fill="#A80036" points="616.5,375.5781,626.5,379.5781,616.5,383.5781,620.5,379.5781" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="347.5" x2="622.5" y1="379.5781" y2="379.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="235" x="354.5" y="374.5122">image_available_callback(meta_info)</text><rect fill="#EEEEEE" filter="url(#f1cdms72lzbec7)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="880.5" x="0" y="408.1445"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="880.5" y1="408.1445" y2="408.1445"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="880.5" y1="411.1445" y2="411.1445"/><rect fill="#EEEEEE" filter="url(#f1cdms72lzbec7)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="142" x="369.25" y="397.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="123" x="375.25" y="413.645">image download</text><polygon fill="#A80036" points="358.5,447.8438,348.5,451.8438,358.5,455.8438,354.5,451.8438" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="352.5" x2="627.5" y1="451.8438" y2="451.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="257" x="364.5" y="446.7778">get_by_unid(unid, uiid, image_ready_cb)</text><path d="M30,466.8438 L94,466.8438 L94,473.8438 L84,483.8438 L30,483.8438 L30,466.8438 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="369.2031" style="stroke:#000000;stroke-width:2.0;" width="820.5" x="30" y="466.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="45" y="479.9106">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="124" x="109" y="479.0542">[image not cached]</text><polygon fill="#A80036" points="758.5,501.1094,768.5,505.1094,758.5,509.1094,762.5,505.1094" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="347.5" x2="764.5" y1="505.1094" y2="505.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="209" x="354.5" y="500.0435">Subscribe: ucl/OTA/data/uiid/unid</text><polygon fill="#A80036" points="758.5,530.2422,768.5,534.2422,758.5,538.2422,762.5,534.2422" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="347.5" x2="764.5" y1="534.2422" y2="534.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="210" x="354.5" y="529.1763">Publish: ucl/OTA/info/uiid/unid/get</text><path d="M40,549.2422 L104,549.2422 L104,556.2422 L94,566.2422 L40,566.2422 L40,549.2422 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="148.4688" style="stroke:#000000;stroke-width:2.0;" width="800.5" x="40" y="549.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="55" y="562.3091">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="108" x="119" y="561.4526">[image received]</text><polygon fill="#A80036" points="358.5,583.5078,348.5,587.5078,358.5,591.5078,354.5,587.5078" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="352.5" x2="769.5" y1="587.5078" y2="587.5078"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="211" x="364.5" y="582.4419">Publish: image file data message</text><polygon fill="#A80036" points="107.5,612.6406,97.5,616.6406,107.5,620.6406,103.5,616.6406" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="101.5" x2="346.5" y1="616.6406" y2="616.6406"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106" x="113.5" y="611.5747">Cache image file</text><polygon fill="#A80036" points="616.5,641.7734,626.5,645.7734,616.5,649.7734,620.5,645.7734" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="347.5" x2="622.5" y1="645.7734" y2="645.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="188" x="354.5" y="640.7075">image_ready_cb(OK, filepath)</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="40" x2="840.5" y1="654.7734" y2="654.7734"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="128" x="45" y="664.9839">[no image received]</text><polygon fill="#A80036" points="616.5,685.7109,626.5,689.7109,616.5,693.7109,620.5,689.7109" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="347.5" x2="622.5" y1="689.7109" y2="689.7109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="175" x="354.5" y="684.645">image_ready_cb(ERROR, "")</text><polygon fill="#A80036" points="758.5,721.8438,768.5,725.8438,758.5,729.8438,762.5,725.8438" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="347.5" x2="764.5" y1="725.8438" y2="725.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="225" x="354.5" y="720.7778">Unsubscribe: ucl/OTA/data/uiid/unid</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="30" x2="850.5" y1="734.8438" y2="734.8438"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="99" x="35" y="745.0542">[image cached]</text><polygon fill="#A80036" points="107.5,765.7813,97.5,769.7813,107.5,773.7813,103.5,769.7813" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="101.5" x2="346.5" y1="769.7813" y2="769.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192" x="113.5" y="764.7153">get image filepath from cache</text><polygon fill="#A80036" points="335.5,794.9141,345.5,798.9141,335.5,802.9141,339.5,798.9141" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="96.5" x2="341.5" y1="798.9141" y2="798.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91" x="103.5" y="793.8481">image filepath</text><polygon fill="#A80036" points="616.5,824.0469,626.5,828.0469,616.5,832.0469,620.5,828.0469" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="347.5" x2="622.5" y1="828.0469" y2="828.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="188" x="354.5" y="822.981">image_ready_cb(OK, filepath)</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="870.5" y1="844.0469" y2="844.0469"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="175" x="15" y="854.2573">[no specific unid available]</text><rect fill="#EEEEEE" filter="url(#f1cdms72lzbec7)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="880.5" x="0" y="878.418"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="880.5" y1="878.418" y2="878.418"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="880.5" y1="881.418" y2="881.418"/><rect fill="#EEEEEE" filter="url(#f1cdms72lzbec7)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="149" x="365.75" y="867.8516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="130" x="371.75" y="883.9185">image availability</text><polygon fill="#A80036" points="358.5,918.1172,348.5,922.1172,358.5,926.1172,354.5,922.1172" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="352.5" x2="769.5" y1="922.1172" y2="922.1172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="172" x="364.5" y="917.0513">Publish: ucl/OTA/info/uiid/all</text><polygon fill="#A80036" points="107.5,947.25,97.5,951.25,107.5,955.25,103.5,951.25" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="101.5" x2="346.5" y1="951.25" y2="951.25"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="214" x="113.5" y="946.1841">Cache image meta info for uiid/all</text><polygon fill="#A80036" points="107.5,976.3828,97.5,980.3828,107.5,984.3828,103.5,980.3828" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="101.5" x2="346.5" y1="980.3828" y2="980.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="181" x="113.5" y="975.3169">get_unids_listening_to_uiid()</text><polygon fill="#A80036" points="335.5,1005.5156,345.5,1009.5156,335.5,1013.5156,339.5,1009.5156" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="96.5" x2="341.5" y1="1009.5156" y2="1009.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="197" x="103.5" y="1004.4497">list of unids listening to the uiid</text><path d="M20,1024.5156 L97,1024.5156 L97,1031.5156 L87,1041.5156 L20,1041.5156 L20,1024.5156 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="501.7344" style="stroke:#000000;stroke-width:2.0;" width="840.5" x="20" y="1024.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="32" x="35" y="1037.5825">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="192" x="112" y="1036.7261">[for all unids listening to uiid]</text><polygon fill="#A80036" points="616.5,1058.7813,626.5,1062.7813,616.5,1066.7813,620.5,1062.7813" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="347.5" x2="622.5" y1="1062.7813" y2="1062.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="235" x="354.5" y="1057.7153">image_available_callback(meta_info)</text><rect fill="#EEEEEE" filter="url(#f1cdms72lzbec7)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="880.5" x="0" y="1091.3477"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="880.5" y1="1091.3477" y2="1091.3477"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="880.5" y1="1094.3477" y2="1094.3477"/><rect fill="#EEEEEE" filter="url(#f1cdms72lzbec7)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="142" x="369.25" y="1080.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="123" x="375.25" y="1096.8481">image download</text><polygon fill="#A80036" points="358.5,1131.0469,348.5,1135.0469,358.5,1139.0469,354.5,1135.0469" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="352.5" x2="627.5" y1="1135.0469" y2="1135.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="257" x="364.5" y="1129.981">get_by_unid(unid, uiid, image_ready_cb)</text><path d="M30,1150.0469 L94,1150.0469 L94,1157.0469 L84,1167.0469 L30,1167.0469 L30,1150.0469 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="369.2031" style="stroke:#000000;stroke-width:2.0;" width="820.5" x="30" y="1150.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="45" y="1163.1138">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="124" x="109" y="1162.2573">[image not cached]</text><polygon fill="#A80036" points="758.5,1184.3125,768.5,1188.3125,758.5,1192.3125,762.5,1188.3125" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="347.5" x2="764.5" y1="1188.3125" y2="1188.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="196" x="354.5" y="1183.2466">Subscribe: ucl/OTA/data/uiid/all</text><polygon fill="#A80036" points="758.5,1213.4453,768.5,1217.4453,758.5,1221.4453,762.5,1217.4453" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="347.5" x2="764.5" y1="1217.4453" y2="1217.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="197" x="354.5" y="1212.3794">Publish: ucl/OTA/info/uiid/all/get</text><path d="M40,1232.4453 L104,1232.4453 L104,1239.4453 L94,1249.4453 L40,1249.4453 L40,1232.4453 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="148.4688" style="stroke:#000000;stroke-width:2.0;" width="800.5" x="40" y="1232.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="55" y="1245.5122">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="108" x="119" y="1244.6558">[image received]</text><polygon fill="#A80036" points="358.5,1266.7109,348.5,1270.7109,358.5,1274.7109,354.5,1270.7109" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="352.5" x2="769.5" y1="1270.7109" y2="1270.7109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158" x="364.5" y="1265.645">image file data message</text><polygon fill="#A80036" points="107.5,1295.8438,97.5,1299.8438,107.5,1303.8438,103.5,1299.8438" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="101.5" x2="346.5" y1="1299.8438" y2="1299.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104" x="113.5" y="1294.7778">cache image file</text><polygon fill="#A80036" points="616.5,1324.9766,626.5,1328.9766,616.5,1332.9766,620.5,1328.9766" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="347.5" x2="622.5" y1="1328.9766" y2="1328.9766"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="188" x="354.5" y="1323.9106">image_ready_cb(OK, filepath)</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="40" x2="840.5" y1="1337.9766" y2="1337.9766"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="128" x="45" y="1348.187">[no image received]</text><polygon fill="#A80036" points="616.5,1368.9141,626.5,1372.9141,616.5,1376.9141,620.5,1372.9141" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="347.5" x2="622.5" y1="1372.9141" y2="1372.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="175" x="354.5" y="1367.8481">image_ready_cb(ERROR, "")</text><polygon fill="#A80036" points="758.5,1405.0469,768.5,1409.0469,758.5,1413.0469,762.5,1409.0469" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="347.5" x2="764.5" y1="1409.0469" y2="1409.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="212" x="354.5" y="1403.981">Unsubscribe: ucl/OTA/data/uiid/all</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="30" x2="850.5" y1="1418.0469" y2="1418.0469"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="99" x="35" y="1428.2573">[image cached]</text><polygon fill="#A80036" points="107.5,1448.9844,97.5,1452.9844,107.5,1456.9844,103.5,1452.9844" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="101.5" x2="346.5" y1="1452.9844" y2="1452.9844"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192" x="113.5" y="1447.9185">get image filepath from cache</text><polygon fill="#A80036" points="335.5,1478.1172,345.5,1482.1172,335.5,1486.1172,339.5,1482.1172" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="96.5" x2="341.5" y1="1482.1172" y2="1482.1172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91" x="103.5" y="1477.0513">image filepath</text><polygon fill="#A80036" points="616.5,1507.25,626.5,1511.25,616.5,1515.25,620.5,1511.25" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="347.5" x2="622.5" y1="1511.25" y2="1511.25"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="188" x="354.5" y="1506.1841">image_ready_cb(OK, filepath)</text><polygon fill="#A80036" points="358.5,1557.3828,348.5,1561.3828,358.5,1565.3828,354.5,1561.3828" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="352.5" x2="627.5" y1="1561.3828" y2="1561.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="178" x="364.5" y="1556.3169">unsubscribe_unid(unid, uiid)</text><polygon fill="#A80036" points="107.5,1586.5156,97.5,1590.5156,107.5,1594.5156,103.5,1590.5156" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="101.5" x2="346.5" y1="1590.5156" y2="1590.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="180" x="113.5" y="1585.4497">remove unid listening to uiid</text><polygon fill="#A80036" points="758.5,1615.6484,768.5,1619.6484,758.5,1623.6484,762.5,1619.6484" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="347.5" x2="764.5" y1="1619.6484" y2="1619.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="219" x="354.5" y="1614.5825">Unsubscribe: ucl/OTA/info/uiid/unid</text><path d="M301.5,1634.6484 L365.5,1634.6484 L365.5,1641.6484 L355.5,1651.6484 L301.5,1651.6484 L301.5,1634.6484 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="46.2656" style="stroke:#000000;stroke-width:2.0;" width="539" x="301.5" y="1634.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="316.5" y="1647.7153">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="219" x="380.5" y="1646.8589">[If no more unids listening to uiid]</text><polygon fill="#A80036" points="758.5,1668.9141,768.5,1672.9141,758.5,1676.9141,762.5,1672.9141" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="347.5" x2="764.5" y1="1672.9141" y2="1672.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="206" x="354.5" y="1667.8481">Unsubscribe: ucl/OTA/info/uiid/all</text><!--MD5=[9b660f4dfb9e2ed3829e6755af139f0b]
@startuml ota_internal.svg
title OTA download from image provider

participant "OTA cache" as OTAC
participant "OTA API" as API
participant "Protocol controller" as PC
participant "Image provider" as IP

PC -> API: subscribe_unid(unid, uiid)

alt If no unids listening to uiid
API -> IP: Subscribe: ucl/OTA/info/uiid/all
end
API -> IP: Subscribe: ucl/OTA/info/uiid/unid
API -> OTAC: unid listening to uiid
alt #LightBlue specific unid available
== image availability ==
IP -> API: Publish: ucl/OTA/info/uiid/unid
API -> OTAC: Cache image meta info for uiid/unid
API -> PC: image_available_callback(meta_info)
== image download ==
PC -> API: get_by_unid(unid, uiid, image_ready_cb)
alt #LightBlue image not cached
API -> IP: Subscribe: ucl/OTA/data/uiid/unid
API -> IP: Publish: ucl/OTA/info/uiid/unid/get
alt #LightBlue image received
IP -> API: Publish: image file data message
API -> OTAC: Cache image file
API -> PC: image_ready_cb(OK, filepath)
else no image received
API -> PC: image_ready_cb(ERROR, "")
end
API -> IP: Unsubscribe: ucl/OTA/data/uiid/unid
else #LightBlue image cached
API -> OTAC: get image filepath from cache
OTAC -> API: image filepath
API -> PC: image_ready_cb(OK, filepath)
end

else #LightGreen no specific unid available
== image availability ==
IP -> API: Publish: ucl/OTA/info/uiid/all
API -> OTAC: Cache image meta info for uiid/all
API -> OTAC: get_unids_listening_to_uiid()
OTAC -> API: list of unids listening to the uiid
loop #LightGreen for all unids listening to uiid
API -> PC: image_available_callback(meta_info)
== image download ==
PC -> API: get_by_unid(unid, uiid, image_ready_cb)
alt #LightGreen image not cached
API -> IP: Subscribe: ucl/OTA/data/uiid/all
API -> IP: Publish: ucl/OTA/info/uiid/all/get
alt #LightGreen image received
IP -> API: image file data message
API -> OTAC: cache image file
API -> PC: image_ready_cb(OK, filepath)
else #LightGreen no image received
API -> PC: image_ready_cb(ERROR, "")
end
API -> IP: Unsubscribe: ucl/OTA/data/uiid/all
else #LightGreen image cached
API -> OTAC: get image filepath from cache
OTAC -> API: image filepath
API -> PC: image_ready_cb(OK, filepath)
end
end
end
PC -> API: unsubscribe_unid(unid, uiid)
API -> OTAC: remove unid listening to uiid
API -> IP: Unsubscribe: ucl/OTA/info/uiid/unid
alt If no more unids listening to uiid
API -> IP: Unsubscribe: ucl/OTA/info/uiid/all
end
@enduml

PlantUML version 1.2022.0(Tue Jan 11 16:16:42 UTC 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: ANSI_X3.4-1968
Language: en
Country: US
--></g></svg>
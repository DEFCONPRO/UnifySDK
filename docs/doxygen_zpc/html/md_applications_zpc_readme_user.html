<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Z-Wave Protocol Controller: ZPC User&#39;s Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Z-Wave Protocol Controller
   &#160;<span id="projectnumber">1.0.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_applications_zpc_readme_user.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">ZPC User's Guide </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>ZPC translates the Unify Controller Language(UCL) into Z-Wave commands and communicates with Z-Wave devices in a Z-Wave network.</p>
<h1><a class="anchor" id="autotoc_md11"></a>
Installation</h1>
<p>The ZPC is installed on a Debian Buster platform using the uic-zpc Debian package provided with the SDK.</p>
<div class="fragment"><div class="line">apt install uic-zpc_&lt;version&gt;_armhf.deb</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md12"></a>
Files</h2>
<p>The Debian package of the ZPC contains the following files:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Path  </th><th class="markdownTableHeadNone">Description   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">/lib/systemd/system/uic-zpc.service  </td><td class="markdownTableBodyNone">Systemd service file   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">/usr/bin/zpc  </td><td class="markdownTableBodyNone">ZPC application   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">/usr/share/bash-completion/completions/zpc  </td><td class="markdownTableBodyNone">script for bash auto completion   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">/usr/share/doc/uic-zpc/copyright  </td><td class="markdownTableBodyNone">copyright notice   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">/etc/uic/uic.cfg  </td><td class="markdownTableBodyNone">Default location of config file   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">/var/lib/uic/database.db  </td><td class="markdownTableBodyNone">Default location of database   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">/usr/share/uic/rules  </td><td class="markdownTableBodyNone">Default location of mapping rules   </td></tr>
</table>
<h3><a class="anchor" id="autotoc_md13"></a>
Configuration File</h3>
<p>The configuration file is written in YAML and is used to set up the ZPC. The ZPC can dump the running configuration, which can be used as a starting point for the config file.</p>
<p>Configuration file example:</p>
<div class="fragment"><div class="line">$ zpc --dump-config</div>
<div class="line"># Unify sample conf file</div>
<div class="line"> </div>
<div class="line">datastore:</div>
<div class="line">  - file:&#39;/var/lib/uic/database.db&#39;</div>
<div class="line">log:</div>
<div class="line">  - level:&#39;d&#39;</div>
<div class="line">  - tag_level:&#39;uic_main:debug&#39;</div>
<div class="line">mapdir: &#39;/usr/share/uic/rules&#39;</div>
<div class="line">mqtt:</div>
<div class="line">  - host:&#39;localhost&#39;</div>
<div class="line">  - port:1883</div>
<div class="line">zpc:</div>
<div class="line">  - accepted_transmit_failure:2</div>
<div class="line">  - default_wakeup_interval:4200</div>
<div class="line">  - device_id:&#39;36833760FCEF5E5C8E66077764918592&#39;</div>
<div class="line">  - hardware_version:1</div>
<div class="line">  - manufacturer_id:0</div>
<div class="line">  - measured_0dbm_power:0</div>
<div class="line">  - missing_wakeup_notification:2</div>
<div class="line">  - normal_tx_power_dbm:0</div>
<div class="line">  - product_id:1</div>
<div class="line">  - product_type:1</div>
<div class="line">  - rf_region:&#39;EU&#39;</div>
<div class="line">  - serial:&#39;/dev/ttyUSB0&#39;</div>
<div class="line">  - serial_log_file:&#39;&#39;</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md14"></a>
Database File</h3>
<p>The ZPC uses a sqlite database for storing network information. The default location of the database is /var/lib/uic/database.db. The database must be located in a writable part of the file system. If the database is lost, the ZPC will lose vital information about the network and need to probe all nodes in the network.</p>
<h1><a class="anchor" id="autotoc_md15"></a>
Running ZPC</h1>
<p>You can run the ZPC either by using the systemd service, that is installed through the Debian package, or by running the ZPC from the command line.</p>
<h2><a class="anchor" id="autotoc_md16"></a>
Running ZPC Using Systemd</h2>
<p>Normally, the ZPC, which is installed as a systemd service, should be run as a service.</p>
<p>You can start and stop the ZPC service with the systemctl command (see systemctl linux manual for details).</p>
<div class="fragment"><div class="line">sudo systemctl start uic-zpc</div>
<div class="line">sudo systemctl stop uic-zpc</div>
</div><!-- fragment --><p>To see the logs of the ZPC when it runs as a service, use the following command:</p>
<div class="fragment"><div class="line">journalctl -u uic-zpc.service</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md17"></a>
Running ZPC From the Command Line</h2>
<p>Running the ZPC from the command line provides a Command Line Interface (CLI) that supports various debugging commands. To get more information about the commands, type <code>help</code> in the CLI.</p>
<p>These are the steps to run the ZPC from the command line:</p>
<ol type="1">
<li>Ensure Mosquitto broker is running, either by systemd <code>sudo systemctl start mosquitto</code> or by running <code>mosquitto -d</code> in a terminal.</li>
<li>Run <code>/usr/bin/zpc</code>.</li>
</ol>
<blockquote class="doxtable">
<p>To get more information about command line arguments for ZPC, run <code>/usr/bin/zpc --help</code>. </p>
</blockquote>
<p>Note that the default permissions for the ZPC database file located in /var/lib/uic/database.db is only writable for the <em>uic</em> system user (which is created upon installation). If you run the zpc as another user, select a different database location.</p>
<p>For example,</p>
<div class="fragment"><div class="line">zpc --zpc.serial /dev/ttyUSB0 --zpc.rf_region EU --datastore.file mydatabase.db --mapdir rules</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md18"></a>
(Advanced) Configuring ZPC to Use TLS Certificate-Based Encryption</h3>
<h4><a class="anchor" id="autotoc_md19"></a>
Self Signed Certificate Generation</h4>
<p>The following script can generate and self sign the necessary certificates for connection ZPC to MQTT broker in the directory format shown below.</p>
<div class="fragment"><div class="line">scripts/tls-certificates-generation.sh &lt;broker IP/hostname&gt;</div>
</div><!-- fragment --><p>Default: localhost (MQTT broker and ZPC are running on the same machine)</p>
<div class="fragment"><div class="line">$ tree .</div>
<div class="line">├── broker</div>
<div class="line">│   ├── broker.crt</div>
<div class="line">│   └── broker.key</div>
<div class="line">├── ca</div>
<div class="line">│   ├── ca.crt</div>
<div class="line">│   ├── ca.key</div>
<div class="line">│   └── ca.srl</div>
<div class="line">└── client</div>
<div class="line">    ├── client.crt</div>
<div class="line">    └── client.key</div>
</div><!-- fragment --><p>Passing <code>--mqtt.cafile (ca/ca.crt)</code>, <code>--mqtt.certfile (client/client.crt)</code> and <code>--mqtt.keyfile (client/client.key)</code> enables the TLS support in ZPC.</p>
<p>Having the config options: <code>"cafile" (client/ca.crt)</code>, <code>"certfile" (broker/broker.crt)</code> and <code>"keyfile" (broker/broker.key)</code> in Mosquitto Broker config file will make Broker communicate with ZPC with TLS encryption.</p>
<h4><a class="anchor" id="autotoc_md20"></a>
Broker Configurations</h4>
<p>Configure the Mosquitto broker with the following parameters to enable TLS support. Broker can support TLS and non-TLS communication simultaneously on two different ports. For example, in the following mosquitto.conf, Mosquitto Broker will accept non-TLS communication on port 1883.</p>
<p>While on port 8883 Mosquitto Broker will need ZPC to pass correct &ndash;mqtt.cafile, &ndash;mqtt.certfile and &ndash;mqtt.keyfile on command line to connect to TLS encrypted communication with ZPC.</p>
<p>This will allow UPVL and DEV_GUI and other MQTT Clients to have non-DTLS connection to Broker on port 1883 while ZPC can have TLS connection to Broker on port 8883.</p>
<h5>mosquitto.conf</h5>
<div class="fragment"><div class="line">port 1883</div>
<div class="line">allow_anonymous true</div>
<div class="line">per_listener_settings true</div>
<div class="line"> </div>
<div class="line">listener 8883</div>
<div class="line">cafile ca/ca.crt</div>
<div class="line">certfile broker/broker.crt</div>
<div class="line">keyfile broker/broker.key</div>
<div class="line">require_certificate true</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md21"></a>
ZPC command line options</h4>
<h5>CA File</h5>
<p>Path to file containing the PEM encoded CA certificate to connect to Mosquitto MQTT broker for TLS encryption </p><div class="fragment"><div class="line">--mqtt.cafile arg</div>
</div><!-- fragment --><h5>Client Certificate File</h5>
<p>Path to file containing the PEM encoded client certificate to connect to Mosquitto MQTT broker for TLS encryption</p>
<div class="fragment"><div class="line">--mqtt.certfile arg</div>
</div><!-- fragment --><h5>Client Private Key File</h5>
<p>Path to file containing the PEM encoded CA certificate to connect to Mosquitto MQTT broker for TLS encryption</p>
<div class="fragment"><div class="line">--mqtt.keyfile arg</div>
</div><!-- fragment --><p>Note: ZPC does not support encrypted keyfile</p>
<p>TLS support example:</p>
<div class="fragment"><div class="line">zpc --zpc.serial /dev/ttyUSB0 --zpc.rf_region EU --datastore.file mydatabase.db --mapdir rules --mqtt.cafile ca/ca.crt --mqtt.certfile client/client.crt --mqtt.keyfile client/client.key</div>
</div><!-- fragment --><p>When the ZPC starts, the log is printed to stdout, as follows:</p>
<div class="fragment"><div class="line">+ 2020-11-11 14:18:52:276827 &lt;d&gt; [sl_log] Setting log level to debug</div>
<div class="line">+ 2020-11-11 14:18:52:277573 &lt;d&gt; [uic_component_fixtures] Completed: UIC Signal Handler</div>
<div class="line">+ 2020-11-11 14:18:52:277631 &lt;d&gt; [mqtt_client] Constructing new mqtt_client instance.</div>
<div class="line">+ 2020-11-11 14:18:52:277696 &lt;d&gt; [mqtt_wrapper_mosquitto] Initializing Mosquitto library.</div>
</div><!-- fragment --><p>The general log format is as follows:</p>
<div class="fragment"><div class="line">&lt;timestamp&gt; &lt;severity&gt; [tag] &lt;message&gt;</div>
</div><!-- fragment --><p>The log level can be set globally and pr tag.</p>
<p>For example:</p>
<div class="fragment"><div class="line">zpc  --log.level i --log.tag_level uic_component_fixtures:d,mqtt_client:d</div>
</div><!-- fragment --><p>This will set the global log level to info but it enables the debug on the two components such as the following: <a class="el" href="structmqtt__client.html">mqtt_client</a> and uic_component_fixtures.</p>
<h1><a class="anchor" id="autotoc_md22"></a>
Understanding how the ZPC Works</h1>
<p>The purpose of this section is to explain the ZPC behavior and how to correlate frames seen on a Z-Wave Zniffer with operations performed by the ZPC.</p>
<p>The ZPC performs network discovery and operation of for both listening and non listening devices using a software component called the attribute system.</p>
<p>The basic idea of the attribute system is that all network state parameters have a reported value and a desired value. The following are examples of state parameters:</p>
<ul>
<li><em>is the lamp on</em></li>
<li><em>is the door locked</em></li>
<li><em>current room temperature</em></li>
<li>...</li>
</ul>
<p>The reported value of an attribute is data about the current attribute state that the device has communicated to the ZPC. If the device has not told the ZPC what the value is, the reported value is unresolved.</p>
<p>The desired value is the user-preferred attribute value, such as <em>user wants the light to be off</em>. Note that it does not make sense for all attributes to have a desired value. In other words, a smoke detector should not have a desired value to prevent a user from turning if off or setting the smoke to go away.</p>
<p>The ZPC attribute system is used to resolve an unresolved attribute using a set of rules. For instance, you can get the binary switch value of a Z-Wave Binary Switch node by sending the Z-Wave BINARY_SWITCH_GET command. If the attribute system notices that the desired value of an attribute is different than the reported value, the ZPC will issue a Z-Wave SET command.</p>
<blockquote class="doxtable">
<p>Note that the ZPC will only send a SET command if it notices that the reported value of an attribute is different than the desired. The ZPC will do its best to make sure that it has the right reported value by setting up Lifeline associations, but there may be situations where the ZPC has outdated information. </p>
</blockquote>
<p>If a node supports supervision, the ZPC will use supervision encapsulation when sending a SET command. In this way, the ZPC will update the reported value automatically when sending a SET command. If a node does not support supervision, the ZPC will mark the reported value of an attribute unresolved when sending a SET and this will trigger a new GET command for the attribute to update the reported value.</p>
<blockquote class="doxtable">
<p>Currently, when the ZPC sends a SET command with supervision encapsulation and the device reports the supervision state working, the ZPC will not reflect this on the MQTT side. The reported value will be updated on MQTT side when the supervision state OK/FAILED is received. </p>
</blockquote>
<p>The Z-Wave Wake up devices are supported by pausing node resolution when the device is sleeping, which means that if the temperature of a thermostat is changed multiple times while the device is sleeping, the ZPC will only send the latest change using thermostat setpoint command. The ZPC will send wake up no-more information when there is nothing more to resolve regarding the node.</p>
<h1><a class="anchor" id="autotoc_md23"></a>
Dotdot Cluster to Z-Wave Command Class Mapping</h1>
<p>The ZPC maps dotdot clusters to Z-Wave command classes and vice versa. All maps are defined by a set of configuration files which the ZPC loads as boot. However, default files are installed in the folder /usr/share/uic/rules. The mapping file extension is *.uam which is short for Unified Attribute Map.</p>
<p>The following table has a brief description of how ZCL clusters are mapped to Z-Wave command classes.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">DotDot Cluster  </th><th class="markdownTableHeadNone">Z-Wave Command Classes  </th><th class="markdownTableHeadNone">Notes   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">OnOff  </td><td class="markdownTableBodyNone">Binary Switch <br  />
 Basic <br  />
 Multilevel Switch  </td><td class="markdownTableBodyNone">The DotDot OnOff commands (On and Off) are mapped to Z-Wave Binary Switch Set command or Basic SET   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">OccupancySensing  </td><td class="markdownTableBodyNone">Notification  </td><td class="markdownTableBodyNone">The Z-Wave Notification Report command is mapped to Occupancy and OccupacyType DotDot attributes   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">IASZone  </td><td class="markdownTableBodyNone">Notification  </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Illumiance level sensing  </td><td class="markdownTableBodyNone">Notification  </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DoorLock  </td><td class="markdownTableBodyNone">Door Lock  </td><td class="markdownTableBodyNone">The DotDot DoorLock commands (LockDoor and UnlockDoor) are mapped to Z-Wave Door Lock Set command   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Thermostat  </td><td class="markdownTableBodyNone">Multilevel Sensor<br  />
 Thermostat Setpoint <br  />
 Thermostat Mode  </td><td class="markdownTableBodyNone">The DotDot SetpointRaiseOrLower and WriteAttribute commands are mapped to Thermostat Setpoint and Thermostat Mode Commands   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">TemperatureMeasurement  </td><td class="markdownTableBodyNone">Multilevel Sensor  </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Level  </td><td class="markdownTableBodyNone">Multilevel Switch  </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">IASZone  </td><td class="markdownTableBodyNone">Battery  </td><td class="markdownTableBodyNone"></td></tr>
</table>
<h1><a class="anchor" id="autotoc_md24"></a>
Migrating to ZPC from Z/IP Gateway</h1>
<p>This section describes how to migrate to a ZPC from a Z/IP gateway. If migration from a third party gateway is desired, the first step in the migration process is to migrate to a Z/IP Gateway.</p>
<p>To successfully migrate, the following Z/IP Gateway SDK tools are needed.</p><ul>
<li><code>zw_programmer</code> Is required for programming new firmware on the Z-Wave modules and for reading and writing the Z-Wave controller module NVM.</li>
<li><code>zw_nvm_converter</code> this tool is used for converting the Z-Wave NVM between protocol versions. The tool can be use to migrate from a 500 series Z-Wave chip to a 700 series chip.</li>
</ul>
<p>You can get Z/IP Gateway through Simplicity Studio. Read the Z/IP Gateway SDK user guide on how to compile and install the Z/IP gateway on your platform.</p>
<p>For Z-Wave Long Range support, the ZPC requires a Z-Wave API controller version 7.16 or higher. For details about migrating between protocol versions see the Z/IP Gateway manual, <em>Migration Support Tools</em></p>
<p>To ensure that the ZPC is working correctly, it must have access to the network encryption keys as well has information about which security keys have been granted to each node in the network. The Z/IP Gateway stores the encryption keys in the right place in the module NVM for the ZPC to read.</p>
<p>In general, the ZPC will query all network information from the nodes in the network on the first boot, but it needs to know which network keys have been granted to the nodes in the network. The Unify SDK contains the tool <code>zpc_database_tool</code>; which can be used for manipulating the ZPC database. zpc_database_tool can import/export the ZPC database from/to a JSON file. The easiest way to set the granted key information is to do the following:</p><ol type="1">
<li>Migrate the Z-Wave controller using the Z/IP Gateway SDK tools as described above.</li>
<li>Start the ZPC with the migrated Z-Wave controller module but with an empty database file. <code>zpc --datastore.file datastore.db</code></li>
<li>Shut down the ZPC by typing <code>exit</code> on the console. The ZPC will now have created an initial database which matches the Z-Wave network.</li>
<li>Use the zpc_database_tool to export the database to a JSON file <code>zpc_database_tool --datastore.file datastore.db --export datastore.json</code></li>
<li>Open and edit the JSON file and locate the following attributes under each ATTRIBUTE_NODE_ID object:<ul>
<li>ATTRIBUTE_NETWORK_STATUS must be set to "reported": "00"</li>
<li>ATTRIBUTE_KEX_FAIL_TYPE should be set to "reported": "00"</li>
<li>ATTRIBUTE_S2_DSK this is optional but should be set the DSK of the node.</li>
<li>ATTRIBUTE_NODE_IS_S2_CAPABLE should only be defined if the node supports S2</li>
<li>ATTRIBUTE_ZWAVE_INCLUSION_PROTOCOL must be set to 1 if the node was included using Z-Wave long range and should be 0 otherwise.</li>
<li>ATTRIBUTE_ENDPOINT_ID: all endpoint objects besides endpoint 0 must be removed. Endpoint 0 should only contain the ATTRIBUTE_ZWAVE_NIF with no desired or reported values.</li>
<li><p class="startli">ATTRIBUTE_GRANTED_SECURITY_KEYS is a bitmask of which network keys a node have been granted the following keys are currently defined: </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Key  </th><th class="markdownTableHeadNone">Mask   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">ZWAVE_CONTROLLER_S0_KEY  </td><td class="markdownTableBodyNone">0x80   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">ZWAVE_CONTROLLER_S2_UNAUTHENTICATED_KEY  </td><td class="markdownTableBodyNone">0x01   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">ZWAVE_CONTROLLER_S2_AUTHENTICATED_KEY  </td><td class="markdownTableBodyNone">0x02   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">ZWAVE_CONTROLLER_S2_ACCESS_KEY  </td><td class="markdownTableBodyNone">0x04   </td></tr>
</table>
<p class="startli">Ie if a node has all keys the granted keys attribute should be `{ "type": "ATTRIBUTE_GRANTED_SECURITY_KEYS", "reported": "87"} `</p>
</li>
</ul>
</li>
<li>With the updated JSON file, a new database can be constructed with zpc_database_tool. <code>zpc_database_tool --datastore.file datastore.db --import modified_datastore.json</code></li>
<li>You can now start the ZPC as usual. The ZPC will start probing all nodes, sleeping devices will be probed when they wake up.</li>
</ol>
<h2><a class="anchor" id="autotoc_md25"></a>
ZPC Database JSON Example</h2>
<div class="fragment"><div class="line">   {</div>
<div class="line">  &quot;type&quot;: &quot;0x00000001&quot;,</div>
<div class="line">  &quot;children&quot;: [</div>
<div class="line">    {</div>
<div class="line">      &quot;type&quot;: &quot;ATTRIBUTE_HOME_ID&quot;,</div>
<div class="line">      &quot;reported&quot;: &quot;2ab89dc4&quot;,</div>
<div class="line">      &quot;children&quot;: [</div>
<div class="line">        {</div>
<div class="line">          &quot;type&quot;: &quot;ATTRIBUTE_NODE_ID&quot;,</div>
<div class="line">          &quot;reported&quot;: &quot;0100&quot;,</div>
<div class="line">          &quot;children&quot;: [</div>
<div class="line">            {</div>
<div class="line">              &quot;type&quot;: &quot;ATTRIBUTE_ENDPOINT_ID&quot;,</div>
<div class="line">              &quot;reported&quot;: &quot;00&quot;,</div>
<div class="line">              &quot;children&quot;: [</div>
<div class="line">                {</div>
<div class="line">                  &quot;type&quot;: &quot;ATTRIBUTE_ZWAVE_NIF&quot;,</div>
<div class="line">                }</div>
<div class="line">              ]</div>
<div class="line">            },</div>
<div class="line">            {</div>
<div class="line">              &quot;type&quot;: &quot;ATTRIBUTE_NETWORK_STATUS&quot;,</div>
<div class="line">              &quot;reported&quot;: &quot;01&quot;</div>
<div class="line">            },</div>
<div class="line">            {</div>
<div class="line">              &quot;type&quot;: &quot;ATTRIBUTE_GRANTED_SECURITY_KEYS&quot;,</div>
<div class="line">              &quot;reported&quot;: &quot;9f&quot;</div>
<div class="line">            }</div>
<div class="line">          ]</div>
<div class="line">        },</div>
<div class="line">        {</div>
<div class="line">          &quot;type&quot;: &quot;ATTRIBUTE_NODE_ID&quot;,</div>
<div class="line">          &quot;reported&quot;: &quot;0500&quot;,</div>
<div class="line">          &quot;children&quot;: [</div>
<div class="line">            {</div>
<div class="line">              &quot;type&quot;: &quot;ATTRIBUTE_ENDPOINT_ID&quot;,</div>
<div class="line">              &quot;reported&quot;: &quot;00&quot;,</div>
<div class="line">              &quot;children&quot;: [</div>
<div class="line">                {</div>
<div class="line">                  &quot;type&quot;: &quot;ATTRIBUTE_ZWAVE_NIF&quot;,</div>
<div class="line">                }</div>
<div class="line">              ]</div>
<div class="line">            },</div>
<div class="line">            {</div>
<div class="line">              &quot;type&quot;: &quot;ATTRIBUTE_NETWORK_STATUS&quot;,</div>
<div class="line">              &quot;reported&quot;: &quot;01&quot;</div>
<div class="line">            },</div>
<div class="line">            {</div>
<div class="line">              &quot;type&quot;: &quot;ATTRIBUTE_GRANTED_SECURITY_KEYS&quot;,</div>
<div class="line">              &quot;reported&quot;: &quot;00&quot;</div>
<div class="line">            },</div>
<div class="line">            {</div>
<div class="line">              &quot;type&quot;: &quot;ATTRIBUTE_KEX_FAIL_TYPE&quot;,</div>
<div class="line">              &quot;reported&quot;: &quot;00&quot;</div>
<div class="line">            },</div>
<div class="line">            {</div>
<div class="line">              &quot;type&quot;: &quot;ATTRIBUTE_S2_DSK&quot;,</div>
<div class="line">              &quot;reported&quot;: &quot;123498a7ac59a1b9096f99a0edb95e06&quot;</div>
<div class="line">            },</div>
<div class="line">            {</div>
<div class="line">              &quot;type&quot;: &quot;ATTRIBUTE_ZWAVE_PROTOCOL_LISTENING&quot;,</div>
<div class="line">              &quot;reported&quot;: &quot;d3&quot;</div>
<div class="line">            },</div>
<div class="line">            {</div>
<div class="line">              &quot;type&quot;: &quot;ATTRIBUTE_ZWAVE_OPTIONAL_PROTOCOL&quot;,</div>
<div class="line">              &quot;reported&quot;: &quot;9c&quot;</div>
<div class="line">            },</div>
<div class="line">            {</div>
<div class="line">              &quot;type&quot;: &quot;ATTRIBUTE_ZWAVE_INCLUSION_PROTOCOL&quot;,</div>
<div class="line">              &quot;reported&quot;: &quot;00000000&quot;</div>
<div class="line">            },</div>
<div class="line">            {</div>
<div class="line">              &quot;type&quot;: &quot;ATTRIBUTE_NODE_IS_S2_CAPABLE&quot;</div>
<div class="line">            }</div>
<div class="line">          ]</div>
<div class="line">        }</div>
<div class="line">      ]</div>
<div class="line">    }</div>
<div class="line">  ]</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md26"></a>
Performing Backup and Restore</h1>
<p>The backup and restore process works under the assumption that the controller firmware version for the backup and restore is identical.</p>
<p>The following are the backup steps:</p><ul>
<li>Stop the ZPC.</li>
<li>Use zw_programmer to back up the NVM of the Z-Wave module.</li>
<li>Make a copy of the SQLite database used by the ZPC.</li>
<li>Start the ZPC again.</li>
</ul>
<p>The process of restoring a backup is following:</p>
<ul>
<li>Stop the ZPC.</li>
<li>Use zw_programmer to restore the NVM to the Z-Wave module. Copy a backup of the SQLite database to an active SQLite database.</li>
<li>Start the ZPC again.</li>
</ul>
<h1><a class="anchor" id="autotoc_md27"></a>
Performing Firmware Updates</h1>
<p>The ZPC has the capability to perform Firmware Updates. It requires to run and configure the Image Provider application.</p>
<h2><a class="anchor" id="autotoc_md28"></a>
UIID Construction</h2>
<p>To upload an image for a Z-Wave node, compute a Unique Image Identifier (UIID) for this device.</p>
<p>The UIID for the ZPC is a string that can be constructed using the following information:</p>
<ul>
<li>The Manufacturer ID (Manufacturer Specific Command Class)</li>
<li>The Product Type (Manufacturer Specific Command Class)</li>
<li>The Product ID (Manufacturer Specific Command Class)</li>
<li>The Firmware Target (Firmware Update Command Class)</li>
</ul>
<p>The string must be formatted using the following format: <b>ZWave-&lt;ManufacturerID&gt;-&lt;ProductType&gt;-&lt;ProductID&gt;-&lt;FirmwareTarget&gt;</b></p>
<h2><a class="anchor" id="autotoc_md29"></a>
UIID/UNID Association</h2>
<p>When the ZPC interviews a node, it will publish the detected firmware targets under the UIID space in the OTA cluster: <code>ucl/by-unid/&lt;UNID&gt;/ep0/OTA/Attributes/UIID/&lt;UIID&gt;/#</code></p>
<p>For more details about available attributes under each UIID, see the the Unify specification - Common OTA FW Update Service chapter.</p>
<div class="fragment"><div class="line">ucl/by-unid/&lt;UNID&gt;/ep0/OTA/Attributes/UIID/&lt;UIID&gt;/CurrentVersion/Reported</div>
</div><!-- fragment --><p>For example, if a node has 2 Firmware Targets, the publications may look as follows:</p>
<div class="fragment"><div class="line">ucl/by-unid/zw-DB9E8293-0007/ep0/OTA/Attributes/UIID/ZWave-010f-1002-0b01-0000/CurrentVersion/Reported - {&quot;value&quot;: &quot;3.2.0&quot;}</div>
<div class="line">ucl/by-unid/zw-DB9E8293-0007/ep0/OTA/Attributes/UIID/ZWave-010f-1002-0b01-0001/CurrentVersion/Reported - {&quot;value&quot;: &quot;3.2.0&quot;}</div>
</div><!-- fragment --><p>UIID <em>ZWave-010f-1002-0b01-0000</em> can be used to firmware update target 0. UIID <em>ZWave-010f-1002-0b01-0001</em> can be used to firmware update target 1.</p>
<h2><a class="anchor" id="autotoc_md30"></a>
Version String Calculation</h2>
<p>The version of a firmware is determined based on the data reported by the Z-Wave node using the Version Command Class.</p>
<p>The version string will be composed of three decimal digits following <a href="https://semver.org/">semantic versioning</a>. By default, the version for a given firmware will be fetched in the Version Command Class, in the Version Report Command. Only the Major and Minor digits can be retrieved from this report.</p>
<p>For example, if a node sends a Version Report with</p>
<ul>
<li>Firmware 0 Version = 3</li>
<li>Firmware 0 Sub Version = 14</li>
</ul>
<p>The resulting version string will be *"3.14.0"*. No patch version number is available.</p>
<p>If a node supports the Version Z-Wave Software Report Command, the version string for Firmware 0 will be replaced by the Application Version field. For example, if a node sends a Version Z-Wave Software Report Command with:</p>
<ul>
<li>Application Version 1 (MSB) = 3</li>
<li>Application Version 2 = 14</li>
<li>Application Version 3 (LSB) = 15</li>
</ul>
<p>The resulting version string will be *"3.14.15"*.</p>
<h2><a class="anchor" id="autotoc_md31"></a>
Triggering a Firmware Update</h2>
<p>The ZPC will download the available images from the Image Provider whenever a matching UIID (and optional UNID) is advertised as available.</p>
<p>To initiate a firmware update, configure the Image Provider with a compatible image.</p>
<p>The ZPC will initiate a firmware update operation immediately and start publishing the transfer progress in OTA attributes under the UIID space in the OTA cluster.</p>
<p>The ZPC is capable of performing any number of concurrent firmware updates. To avoid network congestion, configure the Image Provider meta data to specify UIID and UNID to control when to apply the firmware of individual nodes.</p>
<p>The <em>ApplyAfter</em> parameter can also be used to delay firmware transfers.</p>
<h2><a class="anchor" id="autotoc_md32"></a>
Aborting a Firmware Update</h2>
<p>There is currently no way to abort an ongoing Firmware Update.</p>
<h2><a class="anchor" id="autotoc_md33"></a>
After a Successful Firmware Update</h2>
<p>The ZPC will not automatically re-interview a node that was OTA firmware updated. An IoT Service must instruct the ZPC to perform a new node interview to discover the new capabilities and version information of a node.</p>
<h2><a class="anchor" id="autotoc_md34"></a>
Examples</h2>
<p>This sections provides an example using the Image Provider and Developer GUI to perform a firmware update of a PowerStrip sample application.</p>
<p>First, make sure that the ZPC, Image Provider and Developer GUI are running.</p>
<p>Flash a PowerStrip application on a Z-Wave module with the OTA bootloader and GBL encryption keys. See the Z-Wave/Gecko SDK documentation in <a href="https://www.silabs.com/developers/simplicity-studio">Simplicity Studio</a></p>
<p>Start the DevGUI and include a PowerStrip (or any other) sample application. At the end of the interview, the OTA Cluster page will show the UIID of the PowerStrip.</p>
<p><img src="powerstrip_uiid_dev_gui.png" alt="" class="inline" title="PowerStrip UIID in DevGUI"/>   </p>
<p>Prepare a GBL file with a newer firmware version that you upload to the Image Provider application. It will require several versions of the Z-Wave/Gecko SDK installed to access binaries with older or newer versions.</p>
<p>You can also perform the operation with an identical firmware image (or older) but the end node will reject the upgrade operation after the transfer.</p>
<p>Verify that your images are ready and readable:</p>
<div class="fragment"><div class="line">pi@unify:/var/lib/uic-image-provider/updates $ ls -l</div>
<div class="line">-rw-r--r-- 1 pi  pi   171380 Aug 17 14:52 powerstrip.gbl</div>
<div class="line">-rw-r--r-- 1 pi  pi   168036 Aug 17 14:52 sensor_pir.gbl</div>
</div><!-- fragment --><p>Then, use the found UIID to configure the <em>image.json</em> file from the image provider. Remember to set a version string as well as calculate the Md5 as described in the Image Provider User Guide:</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  &quot;Version&quot;: &quot;1&quot;,</div>
<div class="line">  &quot;Images&quot;: [</div>
<div class="line">    {</div>
<div class="line">      &quot;FileName&quot;: &quot;updates/powerstrip.gbl&quot;,</div>
<div class="line">      &quot;Uiid&quot;: &quot;ZWave-0000-0005-0004-0000&quot;,</div>
<div class="line">      &quot;Unid&quot;: [&quot;zw-DB9E8293-0002&quot;],</div>
<div class="line">      &quot;Version&quot;: &quot;10.16.4&quot;,</div>
<div class="line">      &quot;ApplyAfter&quot;: &quot;2021-06-29T16:39:57+02:00&quot;,</div>
<div class="line">      &quot;Md5&quot;: &quot;4XbdcGq2iXOD1EcZ905XxQ==&quot;</div>
<div class="line">    }</div>
<div class="line">  ]</div>
<div class="line">}</div>
</div><!-- fragment --><p>Shortly after, the Image Provider will anounce the image(s) over MQTT and the ZPC will download this image, if some nodes in its network have matching UIIDs. The Dev GUI will show the Image Provider announcement under the "Images" tabs in the OTA cluster page:</p>
<p><img src="powerstrip_image_available_dev_gui.png" alt="" class="inline" title="PowerStrip UIID image available in DevGUI"/>   </p>
<p>As soon as the ApplyAfter timestamp is passed, you will be able to observe the firmware transfer operation under the DevGUI:</p>
<p><img src="dev_gui_powerstrip_firmware_transfer.png" alt="" class="inline" title="PowerStrip firmware transfer in DevGUI"/>   </p>
<p>When the firmware update is finished and successful, it will look as follows:</p>
<p><img src="dev_gui_powerstrip_firmware_transfer_complete.png" alt="" class="inline" title="PowerStrip firmware transfer completed in DevGUI"/>   </p>
<p>The following conditions have to be met for a successful firmware transfer:</p>
<ul>
<li>The Size/Offset attributes are non-zero and set to the same value (The DevGUi will show 100%)</li>
<li>The LastError attribute is set to "Success"</li>
<li>The Status attribute is back to "Idle"</li>
</ul>
<p>for example:</p>
<div class="fragment"><div class="line">ucl/by-unid/&lt;UNID&gt;/ep0/OTA/Attributes/UIID/&lt;UIID&gt;/Offset/Reported - {<span class="stringliteral">&quot;value&quot;</span>: 171380}</div>
<div class="line">ucl/by-unid/&lt;UNID&gt;/ep0/OTA/Attributes/UIID/&lt;UIID&gt;/Size/Reported - {<span class="stringliteral">&quot;value&quot;</span>: 171380}</div>
<div class="line">ucl/by-unid/&lt;UNID&gt;/ep0/OTA/Attributes/UIID/&lt;UIID&gt;/LastError/Reported - {<span class="stringliteral">&quot;value&quot;</span>: <span class="stringliteral">&quot;Success&quot;</span>}</div>
<div class="line">ucl/by-unid/&lt;UNID&gt;/ep0/OTA/Attributes/UIID/&lt;UIID&gt;/Status/Reported - {<span class="stringliteral">&quot;value&quot;</span>: <span class="stringliteral">&quot;Idle&quot;</span>}</div>
</div><!-- fragment --><p>At that point, an IoT Service must interview the node again, and the new firmware data and capabilites will be available.</p>
<p><img src="dev_gui_node_interview_button.png" alt="" class="inline" title="Re-interview button in DevGUI"/>   </p>
<h2><a class="anchor" id="autotoc_md35"></a>
Possible Errors</h2>
<p>There are a few possible errors described in the Unify specification. The <em>LastError</em> attribute indicates the status of the last Firmware Update/transfer attempt.</p>
<p><img src="dev_gui_possible_firmware_udpate_errors.png" alt="" class="inline" title="Errors during Firmware Update"/>   </p>
<ul>
<li><b>InvalidImage</b> This error happens if the node rejected the image. Reasons can include the signature verification, the version downgrade protection or a wrong checksum.</li>
<li><b>NotSupported</b> This error happens if the node's firmware is not upgradable. This error will be reported by the end node before any transfer is attempted.</li>
<li><b>Aborted</b> This error can happen if the transfer could not complete without a timeout.</li>
</ul>
<p>In the case of an abort, you can retry a Firmware Update by modifying the Image Provider list of images. Remove the UIID(/UNID) combination, wait for the image Provider to advertise that the image is no longer available, and modify back the image list with the desired UIID(/UNID) combination.</p>
<h1><a class="anchor" id="autotoc_md36"></a>
Z-Wave Certification Information</h1>
<h2><a class="anchor" id="autotoc_md37"></a>
Device Type and Role Type</h2>
<p>The ZPC has a Generic Controller Device type and uses the following device classes.</p><ul>
<li>GENERIC_TYPE_GENERIC_CONTROLLER</li>
<li>SPECIFIC_TYPE_NOT_USED</li>
</ul>
<p>The ZPC uses the Central Static Controller (CSC) role type, which supports and takes the SIS role by default.</p>
<p>The ZPC does not support the following network functionalities:</p><ul>
<li>Learn Mode</li>
<li>Failed Replace</li>
</ul>
<h2><a class="anchor" id="autotoc_md38"></a>
Manufacturer-Specific Information</h2>
<p>The ZPC uses the following manufacturer-specific information:</p><ul>
<li>Manufacturer ID : 0x0000</li>
<li>Product Type : 0x0005</li>
<li>Product ID : 0x0001</li>
<li>Firmware ID : 0x0001</li>
</ul>
<h2><a class="anchor" id="autotoc_md39"></a>
Network Management Information</h2>
<p>This product can be operated in any Z-Wave network with other Z-Wave-certified devices from other manufacturers. All mains operated nodes within the network will act as repeaters regardless of vendor to increase reliability of the network.</p>
<h3><a class="anchor" id="autotoc_md40"></a>
Network Management</h3>
<p>The <a href="./md_applications_dev_ui_dev_gui_readme_user.html">Dev GUI User's Guide</a> describes how to perform the following operations:</p><ul>
<li>Direct range and Network-Wide Inclusion (Add) of other nodes in the network.</li>
<li>Direct range and Network-Wide Exclusion (remove) of other nodes (in any network).</li>
</ul>
<p>Learn mode and Controller replication are not available.</p>
<h2><a class="anchor" id="autotoc_md41"></a>
Association Command Class Information</h2>
<p>The ZPC supports the following Association Groups </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Grouping Identifier  </th><th class="markdownTableHeadNone">Maximum Number of Associations  </th><th class="markdownTableHeadNone">Group Name  </th><th class="markdownTableHeadNone">Usage/Trigger   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">1  </td><td class="markdownTableBodyNone">10  </td><td class="markdownTableBodyNone">Lifeline  </td><td class="markdownTableBodyNone">Lifeline reports.   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md42"></a>
Multilevel Switch Command Class Control</h2>
<p>The ZPC controls the Multilevel Switch Command Class. It is possible to set and see the current level of a multilevel switch supporting node.</p>
<p>However, the model on which the Unify system and <a href="./md_applications_dev_ui_dev_gui_readme_user.html">Dev GUI</a> operate is based on The Dotdot model.</p>
<p>This means that Multilevel Switch supporting node will be represented with both an OnOff and a Level functionality. The Level setting can be changed independently, but will be interpreted in conjunction with the OnOff State.</p>
<p>In short:</p>
<ul>
<li>If OnOff is off, the Multilevel Switch value at the end node will be 0, no matter what the current level shows.</li>
<li>If OnOff is on, the Multilevel Switch value at the end node will be according to the level setting.</li>
</ul>
<h2><a class="anchor" id="autotoc_md43"></a>
Indicator Command Class Information</h2>
<p>The ZPC supports identifying itself. The log output will indicate that a blinking script is invoked. No visible LED is available for this purpose.</p>
<div class="fragment"><div class="line">&lt;datetime&gt; &lt;d&gt; [zwave_command_class_indicator] calling blinker on_time:600ms, off_time:200ms, num_cycles:3</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md44"></a>
Device Reset Locally Command Class Information</h2>
<p>The ZPC can be reset to default. The <a href="./md_applications_dev_ui_dev_gui_readme_user.html">Dev GUI User guide</a> details how to request the ZPC to initiate a reset procedure.</p>
<h2><a class="anchor" id="autotoc_md45"></a>
Command Class Information</h2>
<p>The following table shows supported and controlled Z-Wave Command Classes by the ZPC.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Command Class  </th><th class="markdownTableHeadNone">Version  </th><th class="markdownTableHeadNone">Support  </th><th class="markdownTableHeadNone">Control  </th><th class="markdownTableHeadNone">Security Level  </th><th class="markdownTableHeadNone">Comment   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Basic  </td><td class="markdownTableBodyNone">2  </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">x  </td><td class="markdownTableBodyNone">N/A  </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Binary Switch  </td><td class="markdownTableBodyNone">2  </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">x  </td><td class="markdownTableBodyNone">N/A  </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Switch Multilevel  </td><td class="markdownTableBodyNone">4  </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">x  </td><td class="markdownTableBodyNone">N/A  </td><td class="markdownTableBodyNone">Partial control: <br  />
1. we do not use start/stop level change.<br  />
2. we do not support the 0xFF duration   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Binary Sensor  </td><td class="markdownTableBodyNone">1  </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">x  </td><td class="markdownTableBodyNone">N/A  </td><td class="markdownTableBodyNone">Control Part is auto-generated.   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Multilevel Sensor  </td><td class="markdownTableBodyNone">11  </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">x  </td><td class="markdownTableBodyNone">N/A  </td><td class="markdownTableBodyNone">Partial control: <br  />
1. Not all scales are supported <br  />
2. No regular probing is done   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Thermostat Mode  </td><td class="markdownTableBodyNone">3  </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">x  </td><td class="markdownTableBodyNone">N/A  </td><td class="markdownTableBodyNone">Partial Control: Not all modes can be set   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Thermostat Setpoint  </td><td class="markdownTableBodyNone">3  </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">x  </td><td class="markdownTableBodyNone">N/A  </td><td class="markdownTableBodyNone">Partial Control: <br  />
1. No discovery of ambiguous types in v1-v2 <br  />
2. Only a few setpoints can be configured. <br  />
3. Precision/size fields in the set are determined <br  />
automatically by the controller.   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Association Group Info (AGI)  </td><td class="markdownTableBodyNone">3  </td><td class="markdownTableBodyNone">x  </td><td class="markdownTableBodyNone">x  </td><td class="markdownTableBodyNone">Network Scheme  </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Device Reset Locally  </td><td class="markdownTableBodyNone">1  </td><td class="markdownTableBodyNone">x  </td><td class="markdownTableBodyNone">x  </td><td class="markdownTableBodyNone">Network Scheme  </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Z-Wave Plus Info  </td><td class="markdownTableBodyNone">2  </td><td class="markdownTableBodyNone">x  </td><td class="markdownTableBodyNone">x  </td><td class="markdownTableBodyNone">Unencrypted  </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Multi Channel  </td><td class="markdownTableBodyNone">4  </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">x  </td><td class="markdownTableBodyNone">N/A  </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Door Lock  </td><td class="markdownTableBodyNone">2  </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">x  </td><td class="markdownTableBodyNone">N/A  </td><td class="markdownTableBodyNone">Control Part is auto-generated.   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Supervision  </td><td class="markdownTableBodyNone">2  </td><td class="markdownTableBodyNone">x  </td><td class="markdownTableBodyNone">x  </td><td class="markdownTableBodyNone">Unencrypted  </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Notification  </td><td class="markdownTableBodyNone">3  </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">x  </td><td class="markdownTableBodyNone">N/A  </td><td class="markdownTableBodyNone">Partial Control: <br  />
1. No Push/Pull discovery is done.<br  />
2. No Pull sensor support. <br  />
3. Unknown types are not supported. <br  />
4. No Regular probing is done.   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Manufacturer Specific  </td><td class="markdownTableBodyNone">2  </td><td class="markdownTableBodyNone">x  </td><td class="markdownTableBodyNone">x  </td><td class="markdownTableBodyNone">Network Scheme  </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Powerlevel  </td><td class="markdownTableBodyNone">1  </td><td class="markdownTableBodyNone">x  </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">Network Scheme  </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Inclusion Controller  </td><td class="markdownTableBodyNone">1  </td><td class="markdownTableBodyNone">x  </td><td class="markdownTableBodyNone">x  </td><td class="markdownTableBodyNone">Unencrypted  </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Firmware Update  </td><td class="markdownTableBodyNone">7  </td><td class="markdownTableBodyNone">x  </td><td class="markdownTableBodyNone">x  </td><td class="markdownTableBodyNone">Network Scheme  </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Battery  </td><td class="markdownTableBodyNone">3  </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">x  </td><td class="markdownTableBodyNone">N/A  </td><td class="markdownTableBodyNone">Control Part is auto-generated.   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Wake Up  </td><td class="markdownTableBodyNone">3  </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">x  </td><td class="markdownTableBodyNone">N/A  </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Association  </td><td class="markdownTableBodyNone">2  </td><td class="markdownTableBodyNone">x  </td><td class="markdownTableBodyNone">x  </td><td class="markdownTableBodyNone">Network Scheme  </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Version  </td><td class="markdownTableBodyNone">3  </td><td class="markdownTableBodyNone">x  </td><td class="markdownTableBodyNone">x  </td><td class="markdownTableBodyNone">Network Scheme  </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Indicator  </td><td class="markdownTableBodyNone">3  </td><td class="markdownTableBodyNone">x  </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">Network Scheme  </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Time  </td><td class="markdownTableBodyNone">1  </td><td class="markdownTableBodyNone">x  </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">Unencrypted  </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Multi Channel Association  </td><td class="markdownTableBodyNone">3  </td><td class="markdownTableBodyNone">x  </td><td class="markdownTableBodyNone">x  </td><td class="markdownTableBodyNone">Network Scheme  </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Security 0  </td><td class="markdownTableBodyNone">1  </td><td class="markdownTableBodyNone">x  </td><td class="markdownTableBodyNone">x  </td><td class="markdownTableBodyNone">Unencrypted  </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Security 2  </td><td class="markdownTableBodyNone">1  </td><td class="markdownTableBodyNone">x  </td><td class="markdownTableBodyNone">x  </td><td class="markdownTableBodyNone">Unencrypted  </td><td class="markdownTableBodyNone"></td></tr>
</table>
<h2><a class="anchor" id="autotoc_md46"></a>
SmartStart Information</h2>
<p>The ZPC supports including other nodes using SmartStart. Detailed steps to manipulate the SmartStart list are given in the <a href="./md_applications_dev_ui_dev_gui_readme_user.html">Dev GUI User's Guide</a>.</p>
<h2><a class="anchor" id="autotoc_md47"></a>
Z-Wave Long Range Support</h2>
<p>The ZPC can operate as a Z-Wave Long Range controller, operating both on Z-Wave and Z-Wave Long Range PHY/MAC.</p>
<p>Steps to include Z-Wave Long Range nodes using the ZPC are described in the <a href="./md_applications_dev_ui_dev_gui_readme_user.html">Dev GUI User's Guide</a>.</p>
<h2><a class="anchor" id="autotoc_md48"></a>
SmartStart Supported Protocol Detection</h2>
<p>The ZPC can perform SmartStart inclusions both for Z-Wave and Z-Wave Long Range nodes.</p>
<p>The list of supported protocols for a DSK entry is not advertised in the Unify SmartStart list, which means that the ZPC, in some cases, needs to discover which protocols are supported/in range for the SmartStart entry.</p>
<p>If the PreferredProtocols in the SmartStart list entry is contains a single value, the ZPC will only attempt to include the node with the protocol indicated in the PreferredProtocols, without any discovery.</p>
<p>If PreferredProtocols contains no value, the ZPC will use its default configured priority list for inclusion protocols.</p>
<p>If PreferredProtocols contains more than one value, the ZPC will use this list to attempt to include the node.</p>
<p>If the ZPC has several inclusion protocols candidates either from the PreferredProtocols or based on its configuration, it will first listen for SmartStart Prime commands to detect which protocols are available from the node.</p>
<p>In the following use case, the node supports all protocols among two candidates:</p>
<div class="plantumlgraph">
<object type="image/svg+xml" data="inline_umlgraph_6.svg"></object>
</div>
<p>Example, if the node supports only 1 protocol among 2 candidates:</p>
<div class="plantumlgraph">
<object type="image/svg+xml" data="inline_umlgraph_7.svg"></object>
</div>
<p>The result of this procedure (protocol discovery) will not be saved and will be performed at every SmartStart inclusion attempt. It allows to re-assess, every time if a protocol became available. The list of protocols may change due to firmware update or simply due to radio conditions. Z-Wave nodes may come within NWI range after including more nodes in the network, and subsequently join themselves. Therefore, this protocol discovery procedure may happen at every inclusion attempt.</p>
<p>In a Z-Wave network, NWI will be enabled when listening to SmartStart Primes messages and repeated frames will be received by the ZPC. To prevent repeated frames from triggering an early conclusion on which protocols are supported, the ZPC will apply a back-off after receiving a prime message. The back-off should be larger than two seconds.</p>
<div class="plantumlgraph">
<object type="image/svg+xml" data="inline_umlgraph_8.svg"></object>
</div>
<h1><a class="anchor" id="autotoc_md49"></a>
Transitioning from Z/IP Gateway + Z-Ware</h1>
<p>The ZPC provides a subset of Z-Wave features compared to the Z/IP Gateway.</p>
<ul>
<li>The ZPC is based on Generic Controller Device type and it does not support Learn Mode that enables it to be included to other networks.</li>
<li>The ZPC does not contain Installation and Maintenance Framework that provides a method for gathering statistics and performing network maintenance.</li>
<li>The ZPC does not allow to establish arbitrary Associations and only establishes Lifeline Association.</li>
<li>The ZPC does not control all Command Classes fully. For some, the ZPC only provides partial control. Z-Wave Command Classes where the ZPC provides partial control include:<ul>
<li>Switch Multilevel, version 4,</li>
<li>Multilevel Sensor, version 11,</li>
<li>Thermostat Mode, version 3,</li>
<li>Thermostat Setpoint, version 3 and</li>
<li>Notification, version 11. </li>
</ul>
</li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Mon Aug 30 2021 13:07:55 for Z-Wave Protocol Controller by <a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>

<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1366px" preserveAspectRatio="none" style="width:1280px;height:1366px;background:#FFFFFF;" version="1.1" viewBox="0 0 1280 1366" width="1280px" zoomAndPan="magnify"><defs/><g><rect fill="#FFFFFF" height="35.6094" style="stroke:#FFFFFF;stroke-width:0.0;" width="823" x="232.75" y="10"/><text fill="#000000" font-family="Verdana" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="813" x="237.75" y="35.4209">Z-Wave TX parent frame functionality with transports (example)</text><rect fill="#FFFFFF" height="666.3281" style="stroke:#000000;stroke-width:1.0;" width="950.5" x="324" y="467.1953"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="124" x2="124" y1="99.2031" y2="1359.7188"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="388" x2="388" y1="99.2031" y2="1359.7188"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="723.5" x2="723.5" y1="99.2031" y2="1359.7188"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="941" x2="941" y1="99.2031" y2="1359.7188"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1049" x2="1049" y1="99.2031" y2="1359.7188"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1175" x2="1175" y1="99.2031" y2="1359.7188"/><rect fill="#FFFFFF" height="30.2969" style="stroke:#000000;stroke-width:1.0;" width="130" x="59" y="67.9063"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="116" x="66" y="87.9014">User component</text><rect fill="#DEDEDE" height="30.2969" style="stroke:#000000;stroke-width:1.0;" width="88" x="344" y="67.9063"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="74" x="351" y="87.9014">Z-Wave TX</text><rect fill="#FFFFFF" height="30.2969" style="stroke:#000000;stroke-width:1.0;" width="145" x="651.5" y="67.9063"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="131" x="658.5" y="87.9014">Z-Wave Transports</text><rect fill="#DEDEDE" height="46.5938" style="stroke:#000000;stroke-width:1.0;" width="66" x="908" y="51.6094"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="52" x="915" y="71.6045">Z-Wave</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="18" x="932" y="87.9014">S2</text><rect fill="#FFFFFF" height="30.2969" style="stroke:#000000;stroke-width:1.0;" width="91" x="1004" y="67.9063"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="77" x="1011" y="87.9014">Z-Wave API</text><rect fill="#DEDEDE" height="30.2969" style="stroke:#000000;stroke-width:1.0;" width="89" x="1131" y="67.9063"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="75" x="1138" y="87.9014">Z-Wave RX</text><rect fill="#FFFFFF" height="53" style="stroke:#000000;stroke-width:1.0;" width="109" x="10" y="114.2031"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="92" x="14" y="130.27">I have a frame</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="101" x="14" y="145.4028">to be encrypted</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="93" x="14" y="160.5356">and then sent.</text><polygon fill="#000000" points="376,204.8672,386,208.8672,376,212.8672,380,208.8672" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="124" x2="382" y1="208.8672" y2="208.8672"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="151" x="131" y="188.6685">zwave_tx_send_data</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="240" x="131" y="203.8013">(frame data, encapsulation=S2 Auth)</text><rect fill="#FFFFFF" height="38" style="stroke:#000000;stroke-width:1.0;" width="231" x="393" y="221.8672"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="52" x="397" y="237.9341">Queue:</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="71" x="397" y="253.0669">- Frame 1</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="152" x="468" y="253.0669">: Encapsulation S2 Auth</text><polygon fill="#000000" points="712,297.3984,722,301.3984,712,305.3984,716,301.3984" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="388" x2="718" y1="301.3984" y2="301.3984"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="283" x="395" y="281.1997">zwave_controller_transport_send_data</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="133" x="395" y="296.3325">(Frame 1, no parent)</text><polygon fill="#000000" points="929,341.6641,939,345.6641,929,349.6641,933,345.6641" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="724" x2="935" y1="345.6641" y2="345.6641"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="154" x="731" y="325.4653">zwave_s2_send_data</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="133" x="731" y="340.5981">(Frame 1, no parent)</text><polygon fill="#000000" points="735,370.7969,725,374.7969,735,378.7969,731,374.7969" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="729" x2="940" y1="374.7969" y2="374.7969"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="99" x="741" y="369.731">SL_STATUS_OK</text><polygon fill="#000000" points="399,399.9297,389,403.9297,399,407.9297,395,403.9297" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="393" x2="723" y1="403.9297" y2="403.9297"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="99" x="405" y="398.8638">SL_STATUS_OK</text><rect fill="#FFFFFF" height="38" style="stroke:#000000;stroke-width:1.0;" width="220" x="393" y="416.9297"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="117" x="397" y="432.9966">Waits that Z-Wave</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="212" x="397" y="448.1294">Transports callbacks for Frame 1.</text><path d="M324,467.1953 L401,467.1953 L401,474.1953 L391,484.1953 L324,484.1953 L324,467.1953 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="666.3281" style="stroke:#000000;stroke-width:1.0;" width="950.5" x="324" y="467.1953"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="32" x="339" y="480.2622">loop</text><text fill="#000000" font-family="Verdana" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="271" x="416" y="479.4058">[for as many encapsulated frames needed</text><text fill="#000000" font-family="Verdana" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="407" x="416" y="492.2104">(Nonce Get, Encapsulated frame, etc) to get Frame 1 delivered]</text><polygon fill="#000000" points="399,527.2031,389,531.2031,399,535.2031,395,531.2031" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="393" x2="940" y1="531.2031" y2="531.2031"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="151" x="405" y="511.0044">zwave_tx_send_data</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="368" x="405" y="526.1372">(Frame 2 data, encapsulation = None, Parent = Frame 1)</text><rect fill="#FFFFFF" height="53" style="stroke:#000000;stroke-width:1.0;" width="328" x="393" y="544.2031"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="52" x="397" y="560.27">Queue:</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="71" x="397" y="575.4028">- Frame 1</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="152" x="468" y="575.4028">: Encapsulation S2 Auth</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="71" x="397" y="590.5356">- Frame 2</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="249" x="468" y="590.5356">: Encapsulation None, parent=Frame 1</text><polygon fill="#000000" points="712,634.8672,722,638.8672,712,642.8672,716,638.8672" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="388" x2="718" y1="638.8672" y2="638.8672"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="283" x="395" y="618.6685">zwave_controller_transport_send_data</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="185" x="395" y="633.8013">(Frame 2, Parent = Frame 1)</text><polygon fill="#000000" points="929,679.1328,939,683.1328,929,687.1328,933,683.1328" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="724" x2="935" y1="683.1328" y2="683.1328"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="154" x="731" y="662.9341">zwave_s2_send_data</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="185" x="731" y="678.0669">(Frame 2, Parent = Frame 1)</text><polygon fill="#000000" points="735,708.2656,725,712.2656,735,716.2656,731,712.2656" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="729" x2="940" y1="712.2656" y2="712.2656"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="193" x="741" y="707.1997">SL_STATUS_NOT_SUPPORTED</text><polygon fill="#000000" points="1037.5,752.5313,1047.5,756.5313,1037.5,760.5313,1041.5,756.5313" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="724" x2="1043.5" y1="756.5313" y2="756.5313"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="154" x="731" y="736.3325">zwave_s2_send_data</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="185" x="731" y="751.4653">(Frame 2, Parent = Frame 1)</text><polygon fill="#000000" points="735,781.6641,725,785.6641,735,789.6641,731,785.6641" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="729" x2="1048.5" y1="785.6641" y2="785.6641"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="99" x="741" y="780.5981">SL_STATUS_OK</text><polygon fill="#000000" points="399,810.7969,389,814.7969,399,818.7969,395,814.7969" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="393" x2="723" y1="814.7969" y2="814.7969"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="99" x="405" y="809.731">SL_STATUS_OK</text><rect fill="#FFFFFF" height="38" style="stroke:#000000;stroke-width:1.0;" width="220" x="393" y="827.7969"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="117" x="397" y="843.8638">Waits that Z-Wave</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="212" x="397" y="858.9966">Transports callbacks for Frame 2.</text><line style="stroke:#000000;stroke-width:1.0;" x1="1049.5" x2="1091.5" y1="907.3281" y2="907.3281"/><line style="stroke:#000000;stroke-width:1.0;" x1="1091.5" x2="1091.5" y1="907.3281" y2="920.3281"/><line style="stroke:#000000;stroke-width:1.0;" x1="1050.5" x2="1091.5" y1="920.3281" y2="920.3281"/><polygon fill="#000000" points="1060.5,916.3281,1050.5,920.3281,1060.5,924.3281,1056.5,920.3281" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="112" x="1056.5" y="887.1294">Frame being sent</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="77" x="1056.5" y="902.2622">on the radio</text><line style="stroke:#000000;stroke-width:1.0;" x1="1175.5" x2="1217.5" y1="994.8594" y2="994.8594"/><line style="stroke:#000000;stroke-width:1.0;" x1="1217.5" x2="1217.5" y1="994.8594" y2="1007.8594"/><line style="stroke:#000000;stroke-width:1.0;" x1="1176.5" x2="1217.5" y1="1007.8594" y2="1007.8594"/><polygon fill="#000000" points="1186.5,1003.8594,1176.5,1007.8594,1186.5,1011.8594,1182.5,1007.8594" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="80" x="1182.5" y="944.395">continuously</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="57" x="1182.5" y="959.5278">monitors</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="58" x="1182.5" y="974.6606">incoming</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="66" x="1182.5" y="989.7935">messages</text><polygon fill="#000000" points="1060.5,1032.9922,1050.5,1036.9922,1060.5,1040.9922,1056.5,1036.9922" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="1054.5" x2="1174.5" y1="1036.9922" y2="1036.9922"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="77" x="1066.5" y="1031.9263">zwapi_poll</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="10" x="1143.5" y="1031.9263">()</text><polygon fill="#000000" points="399,1077.2578,389,1081.2578,399,1085.2578,395,1081.2578" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="393" x2="1048.5" y1="1081.2578" y2="1081.2578"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="127" x="405" y="1061.0591">zwapi_send_data</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="51" x="536" y="1061.0591">callback</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="196" x="405" y="1076.1919">(Frame 2 transmission results)</text><polygon fill="#000000" points="929,1121.5234,939,1125.5234,929,1129.5234,933,1125.5234" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="388" x2="935" y1="1125.5234" y2="1125.5234"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="151" x="395" y="1105.3247">zwave_tx_send_data</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="51" x="550" y="1105.3247">callback</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="193" x="395" y="1120.4575">(frame 2 transmission results)</text><polygon fill="#000000" points="399,1172.7891,389,1176.7891,399,1180.7891,395,1176.7891" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="393" x2="940" y1="1176.7891" y2="1176.7891"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="283" x="405" y="1156.5903">zwave_controller_transport_send_data</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="51" x="692" y="1156.5903">callback</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="378" x="405" y="1171.7231">Frame 1 transmission completed (no more to encapsulate)</text><rect fill="#FFFFFF" height="38" style="stroke:#000000;stroke-width:1.0;" width="306" x="393" y="1189.7891"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="52" x="397" y="1205.856">Queue:</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="71" x="397" y="1220.9888">- Frame 1</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="227" x="468" y="1220.9888">: Encap. S2 Auth (sent via Frame 2)</text><line style="stroke:#000000;stroke-width:1.0;" x1="388" x2="430" y1="1284.4531" y2="1284.4531"/><line style="stroke:#000000;stroke-width:1.0;" x1="430" x2="430" y1="1284.4531" y2="1297.4531"/><line style="stroke:#000000;stroke-width:1.0;" x1="389" x2="430" y1="1297.4531" y2="1297.4531"/><polygon fill="#000000" points="399,1293.4531,389,1297.4531,399,1301.4531,395,1297.4531" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="187" x="395" y="1249.1216">Process verifies the TX queue</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="151" x="395" y="1264.2544">See that next frame (1)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="322" x="395" y="1279.3872">is to be discarded because of Frame 2 replacing it.</text><polygon fill="#000000" points="135,1337.7188,125,1341.7188,135,1345.7188,131,1341.7188" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="129" x2="387" y1="1341.7188" y2="1341.7188"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="151" x="141" y="1321.52">zwave_tx_send_data</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="51" x="296" y="1321.52">callback</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="193" x="141" y="1336.6528">(frame 1 transmission results)</text><!--MD5=[09a7bbcf31c85ffd04caa553e415716d]
@startuml inline_umlgraph_18.svg
' Style for the diagram
!theme plain
hide footbox

title Z-Wave TX parent frame functionality with transports (example)

' List of participants
participant "User component" as u
participant "Z-Wave TX" as tx #DEDEDE
participant "Z-Wave Transports" as zwave_transports
participant "Z-Wave\nS2" as s2 #DEDEDE
participant "Z-Wave API" as zwapi
participant "Z-Wave RX" as rx #DEDEDE

rnote left of u: I have a frame\nto be encrypted\nand then sent.
u -> tx: <b>zwave_tx_send_data\n(frame data, encapsulation=S2 Auth)

rnote right of tx: <b>Queue:\n<b>- Frame 1</b>: Encapsulation S2 Auth

tx -> zwave_transports: <b>zwave_controller_transport_send_data</b>\n(Frame 1, no parent)
zwave_transports -> s2: <b>zwave_s2_send_data</b>\n(Frame 1, no parent)
s2 -> zwave_transports: SL_STATUS_OK
zwave_transports -> tx: SL_STATUS_OK

rnote right of tx: Waits that Z-Wave\nTransports callbacks for Frame 1.

loop for as many encapsulated frames needed\n(Nonce Get, Encapsulated frame, etc) to get Frame 1 delivered
  s2 -> tx: <b>zwave_tx_send_data</b>\n(Frame 2 data, encapsulation = None, Parent = Frame 1)
  rnote right of tx: <b>Queue:\n<b>- Frame 1</b>: Encapsulation S2 Auth\n<b>- Frame 2</b>: Encapsulation None, parent=Frame 1
  tx -> zwave_transports: <b>zwave_controller_transport_send_data</b>\n(Frame 2, Parent = Frame 1)
  zwave_transports -> s2: <b>zwave_s2_send_data</b>\n(Frame 2, Parent = Frame 1)
  s2 -> zwave_transports: SL_STATUS_NOT_SUPPORTED
  zwave_transports -> zwapi: <b>zwave_s2_send_data</b>\n(Frame 2, Parent = Frame 1)
  zwapi -> zwave_transports: SL_STATUS_OK
  zwave_transports -> tx: SL_STATUS_OK

  rnote right of tx: Waits that Z-Wave\nTransports callbacks for Frame 2.

  zwapi -> zwapi: Frame being sent\non the radio
  rx -> rx: continuously\nmonitors\nincoming\nmessages
  rx -> zwapi: <b>zwapi_poll</b>()
  zwapi -> tx: <b>zwapi_send_data</b> callback\n(Frame 2 transmission results)

  tx -> s2: <b>zwave_tx_send_data</b> callback\n(frame 2 transmission results)
end
s2 -> tx: <b>zwave_controller_transport_send_data</b> callback\nFrame 1 transmission completed (no more to encapsulate)

rnote right of tx: <b>Queue:\n<b>- Frame 1</b>: Encap. S2 Auth (sent via Frame 2)
tx -> tx: Process verifies the TX queue\nSee that next frame (1)\nis to be discarded because of Frame 2 replacing it.

tx -> u: <b>zwave_tx_send_data</b> callback\n(frame 1 transmission results)
@enduml

@startuml inline_umlgraph_18.svg







<style>
  root {
    BackgroundColor white
    FontColor black
    FontName Verdana
    HyperLinkColor blue
    LineColor black
    LineThickness 1
    Margin 5
  }
  caption {
    LineThickness 0
  }
  footer {
    LineThickness 0
  }
  header {
    LineThickness 0
  }
  node {
    MaximumWidth 300
  }
  title {
    FontSize 22
    LineThickness 0
  }
</style>

skinparam ArrowLollipopColor black
skinparam BackgroundColor white
skinparam DefaultFontName Verdana
skinparam DefaultMonospacedFontName Courier
skinparam LifelineStrategy nosolid
skinparam ParticipantPadding 10
skinparam SequenceLifeLineBorderColor black
skinparam Shadowing false
skinparam UseBetaStyle true

skinparam Activity {
  BackgroundColor white
  BarColor black
  BorderColor black
  FontColor black
  FontName Verdana
}
skinparam Boundary {
  FontColor black
}
skinparam Box {
  Padding 5
}
skinparam CircledCharacter {
  FontColor black
  FontName Courier
  Radius 9
}
skinparam Class {
  BackgroundColor white
  BorderColor black
  FontColor black
  FontName Verdana
}
skinparam ClassAttribute {
  FontColor black
  FontName Verdana
}
skinparam ClassStereotype {
  FontColor black
  FontName Verdana
}
skinparam Footer {
  FontColor black
  FontName Verdana
}
skinparam Header {
  FontColor black
  FontName Verdana
}
skinparam Hyperlink {
  Color blue
}
skinparam IconPackage {
  Color black
  BackgroundColor white
}
skinparam IconPrivate {
  Color black
  BackgroundColor white
}
skinparam IconProtected {
  Color black
  BackgroundColor white
}
skinparam IconPublic {
  Color black
  BackgroundColor white
}
skinparam Note {
  FontColor black
  FontName Verdana
}
skinparam Object {
  BorderColor black
}
skinparam Package {
  BorderColor black
  FontColor black
  FontName Verdana
}
skinparam State {
  BackgroundColor white
  BorderColor black
}
skinparam StereotypeA {
  BackgroundColor white
  BorderColor black
}
skinparam StereotypeC {
  BackgroundColor white
  BorderColor black
}
skinparam StereotypeE {
  BackgroundColor white
  BorderColor black
}
skinparam StereotypeI {
  BackgroundColor white
  BorderColor black
}
skinparam StereotypeN {
  BackgroundColor white
  BorderColor black
}
skinparam UseCaseStereoType {
  FontColor black
  FontName Verdana
}
hide footbox

title Z-Wave TX parent frame functionality with transports (example)

participant "User component" as u
participant "Z-Wave TX" as tx #DEDEDE
participant "Z-Wave Transports" as zwave_transports
participant "Z-Wave\nS2" as s2 #DEDEDE
participant "Z-Wave API" as zwapi
participant "Z-Wave RX" as rx #DEDEDE

rnote left of u: I have a frame\nto be encrypted\nand then sent.
u -> tx: <b>zwave_tx_send_data\n(frame data, encapsulation=S2 Auth)

rnote right of tx: <b>Queue:\n<b>- Frame 1</b>: Encapsulation S2 Auth

tx -> zwave_transports: <b>zwave_controller_transport_send_data</b>\n(Frame 1, no parent)
zwave_transports -> s2: <b>zwave_s2_send_data</b>\n(Frame 1, no parent)
s2 -> zwave_transports: SL_STATUS_OK
zwave_transports -> tx: SL_STATUS_OK

rnote right of tx: Waits that Z-Wave\nTransports callbacks for Frame 1.

loop for as many encapsulated frames needed\n(Nonce Get, Encapsulated frame, etc) to get Frame 1 delivered
  s2 -> tx: <b>zwave_tx_send_data</b>\n(Frame 2 data, encapsulation = None, Parent = Frame 1)
  rnote right of tx: <b>Queue:\n<b>- Frame 1</b>: Encapsulation S2 Auth\n<b>- Frame 2</b>: Encapsulation None, parent=Frame 1
  tx -> zwave_transports: <b>zwave_controller_transport_send_data</b>\n(Frame 2, Parent = Frame 1)
  zwave_transports -> s2: <b>zwave_s2_send_data</b>\n(Frame 2, Parent = Frame 1)
  s2 -> zwave_transports: SL_STATUS_NOT_SUPPORTED
  zwave_transports -> zwapi: <b>zwave_s2_send_data</b>\n(Frame 2, Parent = Frame 1)
  zwapi -> zwave_transports: SL_STATUS_OK
  zwave_transports -> tx: SL_STATUS_OK

  rnote right of tx: Waits that Z-Wave\nTransports callbacks for Frame 2.

  zwapi -> zwapi: Frame being sent\non the radio
  rx -> rx: continuously\nmonitors\nincoming\nmessages
  rx -> zwapi: <b>zwapi_poll</b>()
  zwapi -> tx: <b>zwapi_send_data</b> callback\n(Frame 2 transmission results)

  tx -> s2: <b>zwave_tx_send_data</b> callback\n(frame 2 transmission results)
end
s2 -> tx: <b>zwave_controller_transport_send_data</b> callback\nFrame 1 transmission completed (no more to encapsulate)

rnote right of tx: <b>Queue:\n<b>- Frame 1</b>: Encap. S2 Auth (sent via Frame 2)
tx -> tx: Process verifies the TX queue\nSee that next frame (1)\nis to be discarded because of Frame 2 replacing it.

tx -> u: <b>zwave_tx_send_data</b> callback\n(frame 1 transmission results)
@enduml

PlantUML version 1.2022.0(Tue Jan 11 16:16:42 UTC 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: ANSI_X3.4-1968
Language: en
Country: US
--></g></svg>
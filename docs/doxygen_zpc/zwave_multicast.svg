<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1386px" preserveAspectRatio="none" style="width:1642px;height:1386px;background:#FFFFFF;" version="1.1" viewBox="0 0 1642 1386" width="1642px" zoomAndPan="magnify"><defs><filter height="300%" id="f8cev5p0qxbpe" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f8cev5p0qxbpe)" height="158.7969" style="stroke:#000000;stroke-width:2.0;" width="1015.5" x="507.5" y="237.4375"/><rect fill="#FFFFFF" filter="url(#f8cev5p0qxbpe)" height="90.2031" style="stroke:#000000;stroke-width:2.0;" width="514" x="1114" y="1092.7578"/><rect fill="#FFFFFF" height="43.9375" style="stroke:none;stroke-width:1.0;" width="514" x="1114" y="1139.0234"/><line style="stroke:#A80036;stroke-width:1.0;" x1="160" x2="160" y1="40.2969" y2="50.2969"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="160" x2="160" y1="50.2969" y2="91.1016"/><line style="stroke:#A80036;stroke-width:1.0;" x1="160" x2="160" y1="91.1016" y2="120.2344"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="160" x2="160" y1="120.2344" y2="161.0391"/><line style="stroke:#A80036;stroke-width:1.0;" x1="160" x2="160" y1="161.0391" y2="403.2344"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="160" x2="160" y1="403.2344" y2="444.0391"/><line style="stroke:#A80036;stroke-width:1.0;" x1="160" x2="160" y1="444.0391" y2="1342.7578"/><line style="stroke:#A80036;stroke-width:1.0;" x1="574.5" x2="574.5" y1="40.2969" y2="50.2969"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="574.5" x2="574.5" y1="50.2969" y2="91.1016"/><line style="stroke:#A80036;stroke-width:1.0;" x1="574.5" x2="574.5" y1="91.1016" y2="120.2344"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="574.5" x2="574.5" y1="120.2344" y2="161.0391"/><line style="stroke:#A80036;stroke-width:1.0;" x1="574.5" x2="574.5" y1="161.0391" y2="403.2344"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="574.5" x2="574.5" y1="403.2344" y2="444.0391"/><line style="stroke:#A80036;stroke-width:1.0;" x1="574.5" x2="574.5" y1="444.0391" y2="1342.7578"/><line style="stroke:#A80036;stroke-width:1.0;" x1="709.5" x2="709.5" y1="40.2969" y2="50.2969"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="709.5" x2="709.5" y1="50.2969" y2="91.1016"/><line style="stroke:#A80036;stroke-width:1.0;" x1="709.5" x2="709.5" y1="91.1016" y2="120.2344"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="709.5" x2="709.5" y1="120.2344" y2="161.0391"/><line style="stroke:#A80036;stroke-width:1.0;" x1="709.5" x2="709.5" y1="161.0391" y2="403.2344"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="709.5" x2="709.5" y1="403.2344" y2="444.0391"/><line style="stroke:#A80036;stroke-width:1.0;" x1="709.5" x2="709.5" y1="444.0391" y2="1342.7578"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1214" x2="1214" y1="40.2969" y2="50.2969"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1214" x2="1214" y1="50.2969" y2="91.1016"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1214" x2="1214" y1="91.1016" y2="120.2344"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1214" x2="1214" y1="120.2344" y2="161.0391"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1214" x2="1214" y1="161.0391" y2="403.2344"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1214" x2="1214" y1="403.2344" y2="444.0391"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1214" x2="1214" y1="444.0391" y2="1342.7578"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1413" x2="1413" y1="40.2969" y2="50.2969"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1413" x2="1413" y1="50.2969" y2="91.1016"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1413" x2="1413" y1="91.1016" y2="120.2344"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1413" x2="1413" y1="120.2344" y2="161.0391"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1413" x2="1413" y1="161.0391" y2="403.2344"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1413" x2="1413" y1="403.2344" y2="444.0391"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1413" x2="1413" y1="444.0391" y2="1342.7578"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1570" x2="1570" y1="40.2969" y2="50.2969"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1570" x2="1570" y1="50.2969" y2="91.1016"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1570" x2="1570" y1="91.1016" y2="120.2344"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1570" x2="1570" y1="120.2344" y2="161.0391"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1570" x2="1570" y1="161.0391" y2="403.2344"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1570" x2="1570" y1="403.2344" y2="444.0391"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1570" x2="1570" y1="444.0391" y2="1342.7578"/><rect fill="#FEFECE" filter="url(#f8cev5p0qxbpe)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="87" x="115" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="73" x="122" y="24.9951">SomeTask</text><rect fill="#FEFECE" filter="url(#f8cev5p0qxbpe)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="87" x="115" y="1341.7578"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="73" x="122" y="1361.7529">SomeTask</text><rect fill="#FEFECE" filter="url(#f8cev5p0qxbpe)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="110" x="517.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="96" x="524.5" y="24.9951">AttributeStore</text><rect fill="#FEFECE" filter="url(#f8cev5p0qxbpe)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="110" x="517.5" y="1341.7578"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="96" x="524.5" y="1361.7529">AttributeStore</text><rect fill="#FEFECE" filter="url(#f8cev5p0qxbpe)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="133" x="641.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="119" x="648.5" y="24.9951">AttributeResolver</text><rect fill="#FEFECE" filter="url(#f8cev5p0qxbpe)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="133" x="641.5" y="1341.7578"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="119" x="648.5" y="1361.7529">AttributeResolver</text><rect fill="#FEFECE" filter="url(#f8cev5p0qxbpe)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="176" x="1124" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="162" x="1131" y="24.9951">AttributeResolverGroup</text><rect fill="#FEFECE" filter="url(#f8cev5p0qxbpe)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="176" x="1124" y="1341.7578"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="162" x="1131" y="1361.7529">AttributeResolverGroup</text><rect fill="#FEFECE" filter="url(#f8cev5p0qxbpe)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="195" x="1314" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="181" x="1321" y="24.9951">Z-Wave CommandClasses</text><rect fill="#FEFECE" filter="url(#f8cev5p0qxbpe)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="195" x="1314" y="1341.7578"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="181" x="1321" y="1361.7529">Z-Wave CommandClasses</text><rect fill="#FEFECE" filter="url(#f8cev5p0qxbpe)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="91" x="1523" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="77" x="1530" y="24.9951">Z-Wave API</text><rect fill="#FEFECE" filter="url(#f8cev5p0qxbpe)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="91" x="1523" y="1341.7578"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="77" x="1530" y="1361.7529">Z-Wave API</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="17" x="857" y="74.5073">Init</text><polygon fill="#A80036" points="721,108.2344,711,112.2344,721,116.2344,717,112.2344" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="715" x2="1213" y1="112.2344" y2="112.2344"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="480" x="727" y="107.1685">attribute_resolver_register_set_rule_listener(&amp;on_new_set_rule_registered)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="115" x="808" y="144.4448">Command Class Init</text><path d="M1256,166.0391 L1256,221.0391 L1566,221.0391 L1566,176.0391 L1556,166.0391 L1256,166.0391 " fill="#FBFB77" filter="url(#f8cev5p0qxbpe)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1556,166.0391 L1556,176.0391 L1566,176.0391 L1556,166.0391 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="289" x="1262" y="183.106">Each CC will register rules on Desired Z-Wave</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="253" x="1262" y="198.2388">attributes, in this example only one rule</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135" x="1262" y="213.3716">registration is shown.</text><path d="M507.5,237.4375 L584.5,237.4375 L584.5,244.4375 L574.5,254.4375 L507.5,254.4375 L507.5,237.4375 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="158.7969" style="stroke:#000000;stroke-width:2.0;" width="1015.5" x="507.5" y="237.4375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="32" x="522.5" y="250.5044">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="435" x="599.5" y="249.6479">[For each registered rule from the Z-Wave Command Class handler]</text><polygon fill="#A80036" points="721,271.7031,711,275.7031,721,279.7031,717,275.7031" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="715" x2="1412.5" y1="275.7031" y2="275.7031"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="222" x="727" y="270.6372">attribute_resolver_register_rule(...)</text><polygon fill="#A80036" points="1202,300.8359,1212,304.8359,1202,308.8359,1206,304.8359" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="710" x2="1208" y1="304.8359" y2="304.8359"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="200" x="717" y="299.77">on_new_set_rule_registered(...)</text><polygon fill="#A80036" points="585.5,329.9688,575.5,333.9688,585.5,337.9688,581.5,333.9688" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="579.5" x2="1213" y1="333.9688" y2="333.9688"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="556" x="591.5" y="328.9028">attribute_store_register_callback_by_type_and_state(on_settable_attribute_update, ...)</text><path d="M1049,346.9688 L1049,386.9688 L1375,386.9688 L1375,356.9688 L1365,346.9688 L1049,346.9688 " fill="#FBFB77" filter="url(#f8cev5p0qxbpe)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1365,346.9688 L1365,356.9688 L1375,356.9688 L1365,346.9688 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="305" x="1055" y="364.0356">Attribute Resolver Group registers a callback for</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="197" x="1055" y="379.1685">when the attribute value is set.</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="118" x="806.5" y="427.4448">Desired attribute set</text><path d="M5,449.0391 L5,549.0391 L312,549.0391 L312,459.0391 L302,449.0391 L5,449.0391 " fill="#FBFB77" filter="url(#f8cev5p0qxbpe)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M302,449.0391 L302,459.0391 L312,459.0391 L302,449.0391 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="279" x="11" y="466.106">Task sets a number of attributes. This could</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="275" x="11" y="481.2388">e.g. be a command for a ZCL group. In this</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="273" x="11" y="496.3716">example the task will set the same desired</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="286" x="11" y="511.5044">value for the same attribute type on 2 nodes</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138" x="11" y="526.6372">(could e.g. be On to a</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91" x="11" y="541.77">binary switch).</text><polygon fill="#A80036" points="562.5,575.9688,572.5,579.9688,562.5,583.9688,566.5,579.9688" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="160.5" x2="568.5" y1="579.9688" y2="579.9688"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="390" x="167.5" y="574.9028">attribute_store_set_node_attribute_value(1, DESIRED, ON, 1)</text><polygon fill="#A80036" points="1202,605.1016,1212,609.1016,1202,613.1016,1206,609.1016" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="574.5" x2="1208" y1="609.1016" y2="609.1016"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="211" x="581.5" y="604.0356">on_settable_attribute_update(...)</text><path d="M1070,622.1016 L1070,662.1016 L1353,662.1016 L1353,632.1016 L1343,622.1016 L1070,622.1016 " fill="#FBFB77" filter="url(#f8cev5p0qxbpe)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1343,622.1016 L1343,632.1016 L1353,632.1016 L1343,622.1016 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="262" x="1076" y="639.1685">Attribute Group Resolver stores the node</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="36" x="1076" y="654.3013">in the</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="136" x="1116" y="654.3013">multicast_candidates</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="18" x="1256" y="654.3013">list</text><polygon fill="#A80036" points="562.5,688.5,572.5,692.5,562.5,696.5,566.5,692.5" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="160.5" x2="568.5" y1="692.5" y2="692.5"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="390" x="167.5" y="687.4341">attribute_store_set_node_attribute_value(2, DESIRED, ON, 1)</text><polygon fill="#A80036" points="1202,717.6328,1212,721.6328,1202,725.6328,1206,721.6328" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="574.5" x2="1208" y1="721.6328" y2="721.6328"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="211" x="581.5" y="716.5669">on_settable_attribute_update(...)</text><path d="M1070,734.6328 L1070,774.6328 L1353,774.6328 L1353,744.6328 L1343,734.6328 L1070,734.6328 " fill="#FBFB77" filter="url(#f8cev5p0qxbpe)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1343,734.6328 L1343,744.6328 L1353,744.6328 L1343,734.6328 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="262" x="1076" y="751.6997">Attribute Group Resolver stores the node</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="36" x="1076" y="766.8325">in the</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="136" x="1116" y="766.8325">multicast_candidates</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="18" x="1256" y="766.8325">list</text><path d="M564,788.8984 L564,858.8984 L851,858.8984 L851,798.8984 L841,788.8984 L564,788.8984 " fill="#FBFB77" filter="url(#f8cev5p0qxbpe)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M841,788.8984 L841,798.8984 L851,798.8984 L841,788.8984 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="241" x="570" y="805.9653">Attribute Resolver will on its next scan</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="264" x="570" y="821.0981">detect the Desired attribute changes and</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="21" x="570" y="836.231">call</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="161" x="595" y="836.231">attribute_resolver_send()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43" x="756" y="836.231">, which</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="28" x="570" y="851.3638">calls</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="234" x="602" y="851.3638">zpc_attribute_resolver_send_group()</text><polygon fill="#A80036" points="1202,885.5625,1212,889.5625,1202,893.5625,1206,889.5625" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="710" x2="1208" y1="889.5625" y2="889.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="242" x="717" y="884.4966">zpc_attribute_resolver_send_group(1)</text><path d="M1060,902.5625 L1060,1017.5625 L1363,1017.5625 L1363,912.5625 L1353,902.5625 L1060,902.5625 " fill="#FBFB77" filter="url(#f8cev5p0qxbpe)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1353,902.5625 L1353,912.5625 L1363,912.5625 L1353,902.5625 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="270" x="1066" y="919.6294">Attribute Store Group will loop through the</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="136" x="1066" y="934.7622">multicast_candidates</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98" x="1206" y="934.7622">list and find the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="277" x="1066" y="949.895">desired attributes, that can be multicasted.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="282" x="1066" y="965.0278">Each attribute, that can be multicasted over</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="279" x="1066" y="980.1606">Z-Wave will be sent here, and the attributes</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="273" x="1066" y="995.2935">will be marked added to the attribute store</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89" x="1066" y="1010.4263">resolution list.</text><polygon fill="#A80036" points="1558.5,1044.625,1568.5,1048.625,1558.5,1052.625,1562.5,1048.625" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1214" x2="1564.5" y1="1048.625" y2="1048.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="172" x="1221" y="1043.5591">zwave_tx_assign_group(...)</text><polygon fill="#A80036" points="1558.5,1073.7578,1568.5,1077.7578,1558.5,1081.7578,1562.5,1077.7578" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1214" x2="1564.5" y1="1077.7578" y2="1077.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="278" x="1221" y="1072.6919">zwave_tx_scheme_get_node_tx_options(...)</text><path d="M1114,1092.7578 L1178,1092.7578 L1178,1099.7578 L1168,1109.7578 L1114,1109.7578 L1114,1092.7578 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="90.2031" style="stroke:#000000;stroke-width:2.0;" width="514" x="1114" y="1092.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="1129" y="1105.8247">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="84" x="1193" y="1104.9683">[supervision]</text><polygon fill="#A80036" points="1558.5,1127.0234,1568.5,1131.0234,1558.5,1135.0234,1562.5,1131.0234" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1214" x2="1564.5" y1="1131.0234" y2="1131.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="325" x="1221" y="1125.9575">zwave_command_class_supervision_send_data(...)</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1114" x2="1628" y1="1140.0234" y2="1140.0234"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="104" x="1119" y="1150.2339">[no supervision]</text><polygon fill="#A80036" points="1558.5,1170.9609,1568.5,1174.9609,1558.5,1178.9609,1562.5,1174.9609" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1214" x2="1564.5" y1="1174.9609" y2="1174.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="154" x="1221" y="1169.895">zwave_tx_send_data(...)</text><polygon fill="#A80036" points="721,1207.0938,711,1211.0938,721,1215.0938,717,1211.0938" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="715" x2="1213" y1="1211.0938" y2="1211.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="361" x="727" y="1206.0278">attribute_resolver_associate_node_with_tx_sessions_id()</text><polygon fill="#A80036" points="1202,1236.2266,1212,1240.2266,1202,1244.2266,1206,1240.2266" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="710" x2="1208" y1="1240.2266" y2="1240.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="242" x="717" y="1235.1606">zpc_attribute_resolver_send_group(2)</text><path d="M1054,1253.2266 L1054,1323.2266 L1369,1323.2266 L1369,1263.2266 L1359,1253.2266 L1054,1253.2266 " fill="#FBFB77" filter="url(#f8cev5p0qxbpe)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1359,1253.2266 L1359,1263.2266 L1369,1263.2266 L1359,1253.2266 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="294" x="1060" y="1270.2935">When the attribute resolver calls the 2nd send</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="275" x="1060" y="1285.4263">the attribute is already sent as a multicast,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="49" x="1060" y="1300.5591">and the</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="234" x="1113" y="1300.5591">zpc_attribute_resolver_send_group()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="203" x="1060" y="1315.6919">function will return immediately.</text><!--MD5=[5c1bb801930762745b8475fb856cbc2b]
@startuml zwave_multicast.svg
participant SomeTask as t1
participant AttributeStore as as
participant AttributeResolver as ar
participant AttributeResolverGroup as ag
participant "Z-Wave CommandClasses" as cc
participant "Z-Wave API" as zw

... Init ...
ag -> ar : attribute_resolver_register_set_rule_listener(&on_new_set_rule_registered)

... Command Class Init ...
note over cc
    Each CC will register rules on Desired Z-Wave
    attributes, in this example only one rule
    registration is shown.
end note
loop For each registered rule from the Z-Wave Command Class handler
    cc -> ar : attribute_resolver_register_rule(...)
    ar -> ag : on_new_set_rule_registered(...)
    ag -> as : attribute_store_register_callback_by_type_and_state(on_settable_attribute_update, ...)
    note over ag
        Attribute Resolver Group registers a callback for
        when the attribute value is set.
    end note
end

... Desired attribute set ...
note over t1
    Task sets a number of attributes. This could
    e.g. be a command for a ZCL group. In this
    example the task will set the same desired
    value for the same attribute type on 2 nodes
    (could e.g. be On to a
    binary switch).
end note

t1 -> as : attribute_store_set_node_attribute_value(1, DESIRED, ON, 1)
as -> ag : on_settable_attribute_update(...)
note over ag
    Attribute Group Resolver stores the node
    in the <i>multicast_candidates</i> list
end note
t1 -> as : attribute_store_set_node_attribute_value(2, DESIRED, ON, 1)
as -> ag : on_settable_attribute_update(...)
note over ag
    Attribute Group Resolver stores the node
    in the <i>multicast_candidates</i> list
end note

note over ar
    Attribute Resolver will on its next scan
    detect the Desired attribute changes and
    call <i>attribute_resolver_send()</i>, which
    calls <i>zpc_attribute_resolver_send_group()</i>
end note
ar -> ag : zpc_attribute_resolver_send_group(1)
note over ag
    Attribute Store Group will loop through the
    <i>multicast_candidates</i> list and find the
    desired attributes, that can be multicasted.
    Each attribute, that can be multicasted over
    Z-Wave will be sent here, and the attributes
    will be marked added to the attribute store
    resolution list.
end note
ag -> zw : zwave_tx_assign_group(...)
ag -> zw : zwave_tx_scheme_get_node_tx_options(...)
alt supervision
    ag -> zw : zwave_command_class_supervision_send_data(...)
else no supervision
    ag -> zw : zwave_tx_send_data(...)
end
ag -> ar : attribute_resolver_associate_node_with_tx_sessions_id()

ar -> ag : zpc_attribute_resolver_send_group(2)
note over ag
    When the attribute resolver calls the 2nd send
    the attribute is already sent as a multicast,
    and the <i>zpc_attribute_resolver_send_group()</i>
    function will return immediately.
end note
@enduml

PlantUML version 1.2022.0(Tue Jan 11 16:16:42 UTC 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: ANSI_X3.4-1968
Language: en
Country: US
--></g></svg>
# UIC Spec generator

This is the source code for generating the UIC Specification document.

## Build instructions

1. Install doxygen 1.8.17 and GNU Make
2. Install a LaTex distribution (mactex, texlive or similar)
3. run make
4. Inspect the generated document in uic-spec.pdf

## Mac-specific build instructions

1. Install [homebrew](https://brew.sh/)
2. run `brew install doxygen`
3. run `brew cask install mactex`
4. run `brew cask install java` (for plantuml)
5. run make

## Folder structure

    .                            README, Makefile, etc. Run make here
    ├── build                    Autogenerated files. Dont check in.
    │   ├── html                 Doxygen output folder for html generation
    |   |   |                    Unused, but here for sampling html output.
    │   │   └── search
    |   └── pdf                  Doxygen output folder for pdf generation
    │       └── latex            Generated LaTeX code
    ├── doc                      The markdown files to be included in both
    |    |                       pdf and html builds
    |    └── html_only           Markdown files only included in html builds
    ├── figures                  All figure PNG files are stored here.
    │   ├── adding_a_node_1_pan    Source files for generating PNGs for a particular figure here.
    │   └── uic-system-diagram     Another figure's source files
    ├── plantuml                 PlantUML jar file
    └── templates                Customized templates for latex and doxygen
        ├── doxygen
        └── latex

## Markdown reference

Consult the [doxygen markdown reference](http://doxygen.nl/manual/markdown.html) for syntax documentation. Both standard markdown, Extensions and Doxygen specifics are allowed.

## Handling figures

1. For plantuml use the inline
2. Put a PNG figure XXX.png in `figures/` folder.
3. Create a `figures/XXX` folder for the source code generating the figure.
     * For gliffy drawings in confluence, export the XML and save to a file `figures/XXX/XXX.gliffy`.
     * Powerpoint: Save the .pptx here.
     * For draw-io drawings: save to a file `figures/XXX/XXX.drawio`.
     * Optionally add a Makefile that generates the figures/XXX.png file (dont bother for phase 1).

## Documenting topics and JSON payloads

There are two ways to document JSON payloads and MQTT topics.

First way: Write as two-liners. First line for topic, second and following for JSON payload:

    **Topic:** `ucl/by-unid/&lt;UNID&gt;/EndPointID/Cluster`

    **Payload:**
    ```json
        {
            "state": {
                "desired": {
                            "attribute": "value",
                            "attribute": "value"
                            ...
                },
            },
            "SupportedCommands": {"Command1", "Command2", ...},
            "ZCLversion": " 0x03"
        }
    ```

Second way: Tables with JSON payloads in the cells should be written in raw HTML to display properly.

    <table>
    <caption>SmartStart MQTT Topics</caption>
    <tr>
    <th>MQTT Topic</th>
    <th>Description</th>
    <th>Parameters/payload example</th>
    </tr>
    <tr>
    <td>ucl/SmartStart/list</td>
    <td>Used to <br/>
    publish the <br/>
    current <br/>
    SmartStart <br/>
    list (read-only)</td>
    <td>
    ```json
    [
    {
        "DSK": "24859-64107-46202-12845-60475-62452-54892-59867",
        "Include": true,
        "ProtocolControllerUnid": "zw-3849520",
        "Unid": ""
    },

    {
        "DSK": "29304-00703-03201-39471-03987-12013-63902-39874",
        "Include": false,
        "ProtocolControllerUnid": "",
        "Unid": ""
    }
    ]
    ```
    </td>
    </tr>
    </table>

## Releasing a spec

When releasing a spec to customers or internal review, please do the following:

1. run `make spec``
2. git commit everything including unify-spec.pdf. Both master and feature branches are allowed.
3. git tag and git push the commit
4. Jenkins will build both html and pdf spec.
5. Deliver unify-spec.pdf to the recipient.
6. Deliver the html folder to the recipient. Normally, the html recipient is the
   docs.silabs.com contact person.

## Code editor setup

It is recommended to use vscode with the
[markdownlint extension](https://marketplace.visualstudio.com/items?itemName=DavidAnson.vscode-markdownlint).

## Version Requirements

Currently doxygen version 1.8.17 is used. Using other versions has been known to
cause TeX compilation problems. This may be related to the custom latex header
being created by that specific version.

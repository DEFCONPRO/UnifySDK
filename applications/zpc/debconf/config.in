#!/bin/sh -e

. /usr/share/debconf/confmodule

set -e

UIC_CONFDIR=${CPACK_PACKAGING_INSTALL_PREFIX}/etc/uic
UIC_CONFFILE=$UIC_CONFDIR/uic.cfg


if [ -e $UIC_CONFFILE ]; then
    # Replace : With =", append " to each line, Remove all spaces,
    # Remove lines having "", Remove line who do not match "serial|rf_region|file"
    sed -e 's/:/="/g;s/$/"/g;s/ //g;/""/d;/^\(serial\|rf_region\|file\)/!d' $UIC_CONFFILE > $UIC_CONFFILE.sh

    cat $UIC_CONFFILE.sh

    #Source the file to set $serial, $rf_region and $file
    . $UIC_CONFFILE.sh || true

    #Preload debconf with what was in the conf file
    db_set uic-zpc/serial_port "$serial" 
    db_set uic-zpc/region "$rf_region"
    db_set uic-zpc/datastore_file "$file" 
fi


db_input critical uic-zpc/serial_port || true
db_input critical uic-zpc/region || true
db_input critical uic-zpc/datastore_file || true
db_go

